<!DOCTYPE html>
<html>
<head>
  <title>ClickFast</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta http-equiv="Content-Security-Policy" content="frame-ancestors 'self';">
  
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-CFN15J29C2"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-CFN15J29C2');
  </script>
  
  <!-- Google AdSense -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4564506742193898"
     crossorigin="anonymous"></script>
  
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
      color: #333;
      /* Èò≤Ê≠¢ÊâãÊ©üÈÄ£ÈªûÊîæÂ§ß */
      touch-action: manipulation;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      user-select: none;
      /* Èò≤Ê≠¢ÊâãÊ©üÁâà‰∏ãÊãâÂà∑Êñ∞ */
      overscroll-behavior-y: none;
      -webkit-overflow-scrolling: touch;
    }

    html {
      /* Èò≤Ê≠¢ÊâãÊ©üÁâà‰∏ãÊãâÂà∑Êñ∞ */
      overscroll-behavior-y: none;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    .header {
      background: white;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 20px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 15px;
    }

    .header h1 {
      position: relative;
      display: inline-block;
    }

    /* ÈÅäÊà≤Ë™™ÊòéÊåâÈàï */
    .game-help-btn {
      position: absolute;
      bottom: -8px;
      right: -8px;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: #667eea;
      color: white;
      border: 2px solid white;
      font-size: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      transition: all 0.3s ease;
      z-index: 5;
    }

    .game-help-btn:hover {
      background: #5568d3;
      transform: scale(1.1);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    }

    .game-help-btn:active {
      transform: scale(0.95);
    }

    .user-info {
      display: flex;
      gap: 20px;
      align-items: center;
      flex-wrap: wrap;
    }

    /* ÊàêÂ∞±ÂæΩÁ´†ÂÆπÂô®Ê®£ÂºèÔºàÊ®ôÈ°åË¶ñÁ™óÔºâ */
    .badges-container {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    /* ÊàêÂ∞±ÂæΩÁ´†ÂÆπÂô®Ê®£ÂºèÔºàÈÅäÊà≤‰∏ªË¶ñÁ™óÂè≥‰∏äËßíÔºâ */
    .badges-container-game {
      position: absolute;
      top: 15px;
      right: 15px;
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 5px;
      z-index: 10;
    }

    .badges-label {
      font-size: 11px;
      color: #666;
      background: rgba(255, 255, 255, 0.9);
      padding: 2px 8px;
      border-radius: 4px;
      white-space: nowrap;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .badges-slots-container {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .badge-slot {
      width: 50px;
      height: 50px;
      border: 2px dashed #ccc;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #f9f9f9;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
    }

    .badge-slot:hover {
      border-color: #667eea;
      background: #f0f4ff;
      transform: scale(1.05);
    }

    .badge-slot.has-badge {
      border: 2px solid #667eea;
      background: linear-gradient(135deg, #f0f4ff 0%, #e8edff 100%);
    }

    .badge-icon {
      font-size: 28px;
      line-height: 1;
    }

    .badge-slot:not(.has-badge) .badge-icon {
      color: #999;
      font-size: 20px;
    }

    .username-display {
      font-size: 18px;
      font-weight: bold;
      color: #667eea;
      padding: 8px 16px;
      background: #f0f4ff;
      border-radius: 8px;
      border: 2px solid #667eea;
      cursor: pointer;
      transition: all 0.3s;
    }

    .username-display:hover {
      background: #667eea;
      color: white;
      transform: scale(1.05);
    }

    .settings-container {
      position: relative;
      margin-left: 10px;
    }

    .settings-btn {
      font-size: 14px;
      font-weight: bold;
      color: #667eea;
      padding: 6px 12px;
      background: #fff;
      border-radius: 6px;
      border: 2px solid #667eea;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .settings-btn:hover {
      background: #667eea;
      color: white;
      transform: scale(1.05);
    }

    .settings-dropdown {
      display: none;
      position: absolute;
      top: 100%;
      right: 0;
      margin-top: 5px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      min-width: 150px;
      z-index: 1000;
      overflow: hidden;
    }

    .settings-dropdown.active {
      display: block;
    }

    .settings-dropdown-item {
      padding: 12px 16px;
      cursor: pointer;
      transition: background 0.2s;
      border-bottom: 1px solid #f0f0f0;
      color: #333;
      font-size: 14px;
    }

    .settings-dropdown-item:last-child {
      border-bottom: none;
    }

    .settings-dropdown-item:hover {
      background: #f5f5f5;
    }

    .settings-dropdown-item.logout {
      color: #dc3545;
    }

    .settings-dropdown-item.logout:hover {
      background: #fee;
      color: #c82333;
    }

    .stat-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 16px;
    }

    .stat-item strong {
      color: #667eea;
    }

    .coins {
      font-size: 24px;
      font-weight: bold;
      color: #f59e0b;
    }

    .main-content {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }

    .panel {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    .panel h2 {
      margin-bottom: 15px;
      color: #667eea;
      font-size: 20px;
    }

    .game-area {
      grid-column: 1 / -1;
    }

    .login-panel {
      text-align: center;
      padding: 40px;
    }

    .login-panel input {
      padding: 12px;
      font-size: 16px;
      border: 2px solid #667eea;
      border-radius: 5px;
      margin-right: 10px;
      width: 200px;
      /* ÂÖÅË®±Ëº∏ÂÖ•Ê°ÜÈÅ∏ÊìáÊñáÂ≠ó */
      user-select: text;
      -webkit-user-select: text;
    }

    .login-panel button {
      padding: 12px 24px;
      font-size: 16px;
      background: #667eea;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: background 0.3s;
    }

    .login-panel button:hover {
      background: #5568d3;
    }

    .game-container {
      position: relative;
      text-align: center;
      min-height: 400px;
    }

    .timer {
      font-size: 32px;
      font-weight: normal;
      color: #999999;
      margin: 15px 0;
    }

    .click-buttons-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px; /* Ê∏õÂ∞ëÈñìË∑ùÔºåËÆìÊåâÈàïÂíåÂØµÁâ©Êõ¥Èù†Ëøë */
      margin: 20px 0 5px 0; /* Ê∏õÂ∞ëÂ∫ïÈÉ®ÈñìË∑ù */
    }

    /* ‰∏ªÊåâÈàïÂÆπÂô® */
    .main-button-wrapper {
      display: flex;
      justify-content: center;
      width: 100%;
      margin-bottom: 0; /* ÁßªÈô§Â∫ïÈÉ®ÈñìË∑ù */
    }

    /* ÂØµÁâ©Â§•‰º¥ÂÆπÂô® */
    .companion-pets-wrapper {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      justify-content: center;
      align-items: center;
      width: 100%;
      margin: 5px 0 20px 0; /* Ê∏õÂ∞ëÈ†ÇÈÉ®ÈñìË∑ùÔºåÂ¢ûÂä†Â∫ïÈÉ®ÈñìË∑ù */
      padding: 20px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 20px;
      backdrop-filter: blur(10px);
    }

    /* ÂØµÁâ©Â§•‰º¥Âç°Áâá */
    .companion-pet {
      position: relative;
      width: 120px;
      height: 120px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.2) 0%, rgba(255, 255, 255, 0.1) 100%);
      border-radius: 20px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
      transition: all 0.3s ease;
      overflow: visible; /* ÊîπÁÇ∫ visibleÔºåËÆìÊÑõÂøÉÂèØ‰ª•Ë∂ÖÂá∫ÊñπÊ°Ü */
    }

    .companion-pet:hover {
      transform: translateY(-5px) scale(1.05);
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.3);
      border-color: rgba(255, 255, 255, 0.5);
    }

    /* ÂØµÁâ©ÂãïÁï´ÂçÄÂüü */
    .companion-pet-animation {
      font-size: 80px;
      line-height: 1;
      position: relative;
      z-index: 1;
      filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3));
    }

    /* ÂØµÁâ©ÂêçÁ®±Ê®ôÁ±§ */
    .companion-pet-name {
      position: absolute;
      bottom: 8px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 12px;
      font-weight: bold;
      color: white;
      background: rgba(0, 0, 0, 0.6);
      padding: 4px 8px;
      border-radius: 10px;
      white-space: nowrap;
      z-index: 2;
      backdrop-filter: blur(5px);
    }

    /* ÂØµÁâ©Á≠âÁ¥öÊ®ôÁ±§ */
    .companion-pet-level {
      position: absolute;
      top: 8px;
      right: 8px;
      font-size: 11px;
      font-weight: bold;
      color: white;
      background: rgba(102, 126, 234, 0.8);
      padding: 3px 6px;
      border-radius: 8px;
      z-index: 2;
    }

    .click-button {
      padding: 30px 50px;
      font-size: 24px;
      font-weight: bold;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 20px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4),
                  0 4px 8px rgba(0, 0, 0, 0.1),
                  inset 0 1px 0 rgba(255, 255, 255, 0.2);
      min-width: 150px;
      user-select: none;
      position: relative;
      overflow: visible;
      /* Èò≤Ê≠¢ÊâãÊ©üÈÄ£ÈªûÊîæÂ§ß */
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
    }

    .click-button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
      transition: left 0.5s;
    }

    .click-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 28px rgba(102, 126, 234, 0.5),
                  0 6px 12px rgba(0, 0, 0, 0.15),
                  inset 0 1px 0 rgba(255, 255, 255, 0.3);
    }

    .click-button:hover::before {
      left: 100%;
    }

    .click-button:active {
      transform: translateY(0) scale(0.98);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3),
                  0 2px 4px rgba(0, 0, 0, 0.1);
    }

    /* ÈªûÊìäÊôÇÊñáÂ≠ó‰∏ãÊ≤â‰∏äÊµÆÊïàÊûúÔºàÂè™ÊáâÁî®ÊñºÊåâÈàïÂÖßÁöÑÊñáÂ≠óÔºå‰∏çÂΩ±ÈüøÊåâÈàïÊú¨Ë∫´Ôºâ */
    .click-button.click-text-animation .button-text {
      animation: textBounce 0.4s ease-out;
    }

    @keyframes textBounce {
      0% {
        transform: translateY(0);
      }
      50% {
        transform: translateY(8px);
      }
      100% {
        transform: translateY(0);
      }
    }

    /* ÊªëÈº†Ê∏∏Ê®ôÂúñÊ®ô */
    .click-button::after {
      content: 'üñ±Ô∏è';
      position: absolute;
      bottom: 5px;
      right: 5px;
      font-size: 16px;
      opacity: 0.6;
      transition: all 0.3s;
      pointer-events: none;
    }

    .click-button:hover::after {
      opacity: 1;
      transform: scale(1.2);
    }

    .click-button:active::after {
      transform: scale(0.9) translateY(2px);
    }

    .click-button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    /* ÂØµÁâ©ÂãïÁï´ÁâπÊïàÔºàÁï∂Ëá™ÂãïÈªûÊìäËß∏ÁôºÊôÇÔºâ */
    .companion-pet.active {
      animation: petClickPulse 0.4s ease-in-out;
    }

    @keyframes petClickPulse {
      0%, 100% {
        transform: scale(1);
      }
      50% {
        transform: scale(1.15);
        box-shadow: 0 0 30px rgba(102, 126, 234, 0.8);
      }
    }

    /* ÂØµÁâ©ÈªûÊìäÊÑõÂøÉÂãïÁï´ */
    .pet-heart {
      position: absolute;
      font-size: 20px;
      color: #ff69b4; /* Á≤âËâ≤ÊÑõÂøÉ */
      pointer-events: none;
      z-index: 100;
      animation: heartFloat 1.2s ease-out forwards;
      user-select: none;
    }

    @keyframes heartFloat {
      0% {
        opacity: 1;
        transform: translateY(0) scale(0.8);
      }
      20% {
        opacity: 1;
        transform: translateY(-20px) scale(1.3);
      }
      100% {
        opacity: 0;
        transform: translateY(-100px) scale(0.5);
      }
    }

    /* ÊÑõÂøÉÂãïÁï´Ê®£ÂºèÔºàÂ∑≤Á∞°ÂåñÁÇ∫ÂñÆÂÄãÊÑõÂøÉÔºâ */

    /* ÁßªÈô§ËàäÁöÑËá™ÂãïÈªûÊìäÊåâÈàïÊ®£ÂºèÔºåÊîπÁî®ÂØµÁâ©Â§•‰º¥Ê®£Âºè */

    /* Ëá™ÂãïÈªûÊìäÁâπÊïà */
    .click-button.auto-click-animation {
      animation: autoClickPulse 0.4s ease-in-out;
      animation-fill-mode: none;
    }

    /* Ëá™ÂãïÈªûÊìäÊñáÂ≠óÊäñÂãïÊïàÊûú */
    .click-button.auto-click-animation .button-text {
      animation: autoClickTextShake 0.4s ease-in-out;
      animation-fill-mode: none;
    }

    @keyframes autoClickTextShake {
      0%, 100% {
        transform: translateY(0) rotate(0deg);
      }
      10% {
        transform: translateY(-3px) rotate(-1deg);
      }
      20% {
        transform: translateY(3px) rotate(1deg);
      }
      30% {
        transform: translateY(-4px) rotate(-1.5deg);
      }
      40% {
        transform: translateY(4px) rotate(1.5deg);
      }
      50% {
        transform: translateY(-5px) rotate(-2deg);
      }
      60% {
        transform: translateY(5px) rotate(2deg);
      }
      70% {
        transform: translateY(-4px) rotate(-1.5deg);
      }
      80% {
        transform: translateY(3px) rotate(1deg);
      }
      90% {
        transform: translateY(-2px) rotate(-0.5deg);
      }
    }

    @keyframes autoClickPulse {
      0% {
        transform: scale(1);
        box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4),
                    0 4px 8px rgba(0, 0, 0, 0.1);
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }
      30% {
        transform: scale(0.75);
        box-shadow: 0 0 30px rgba(102, 126, 234, 0.9),
                    0 0 60px rgba(118, 75, 162, 0.6),
                    0 4px 12px rgba(0, 0, 0, 0.2);
        background: linear-gradient(135deg, #7c8ef5 0%, #8a5fb8 100%);
      }
      60% {
        transform: scale(1.1);
        box-shadow: 0 0 40px rgba(102, 126, 234, 1),
                    0 0 80px rgba(118, 75, 162, 0.8),
                    0 8px 24px rgba(0, 0, 0, 0.15);
        background: linear-gradient(135deg, #8a9ef8 0%, #9a6fc4 100%);
      }
      100% {
        transform: scale(1);
        box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4),
                    0 4px 8px rgba(0, 0, 0, 0.1);
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }
    }

    /* Ëá™ÂãïÈªûÊìäÊåâÈàïÁöÑ8bitÂãïÁâ©ÂãïÁï´ÂÆπÂô®ÔºàÂü∫Á§éÊ®£ÂºèÂ∑≤Âú®‰∏äÈù¢ÂÆöÁæ©Ôºâ */

    /* ÂØµÁâ©8bitÂãïÁï´ - ËÄÅÈº†ÔºàË∑≥Ë∫çÂãïÁï´Ôºâ */
    .companion-pet[data-animal="mouse"] .companion-pet-animation {
      animation: pixelBounce 0.6s ease-in-out infinite;
      image-rendering: pixelated;
      image-rendering: -moz-crisp-edges;
      image-rendering: crisp-edges;
    }

    /* ÂØµÁâ©8bitÂãïÁï´ - Ë≤ìÔºàÊêñÊì∫ÂãïÁï´Ôºâ */
    .companion-pet[data-animal="cat"] .companion-pet-animation {
      animation: pixelSway 0.8s ease-in-out infinite;
      image-rendering: pixelated;
      image-rendering: -moz-crisp-edges;
      image-rendering: crisp-edges;
    }

    /* ÂØµÁâ©8bitÂãïÁï´ - ÁçÖÂ≠êÔºàÊóãËΩâË∑≥Ë∫çÂãïÁï´Ôºâ */
    .companion-pet[data-animal="lion"] .companion-pet-animation {
      animation: pixelRotateBounce 0.7s ease-in-out infinite;
      image-rendering: pixelated;
      image-rendering: -moz-crisp-edges;
      image-rendering: crisp-edges;
    }

    /* ÂØµÁâ©8bitÂãïÁï´ - Â§ßË±°Ôºà‰∏ä‰∏ãÊµÆÂãïÂãïÁï´Ôºâ */
    .companion-pet[data-animal="elephant"] .companion-pet-animation {
      animation: pixelFloat 1s ease-in-out infinite;
      image-rendering: pixelated;
      image-rendering: -moz-crisp-edges;
      image-rendering: crisp-edges;
    }

    /* ÂØµÁâ©8bitÂãïÁï´ - ÁäÄÁâõÔºàÂ∑¶Âè≥ÊêñÊì∫ÂãïÁï´Ôºâ */
    .companion-pet[data-animal="rhino"] .companion-pet-animation {
      animation: pixelShake 0.9s ease-in-out infinite;
      image-rendering: pixelated;
      image-rendering: -moz-crisp-edges;
      image-rendering: crisp-edges;
    }

    /* ÂØµÁâ©8bitÂãïÁï´ - Ê©üÂô®‰∫∫ÔºàËÑàË°ùÂãïÁï´Ôºâ */
    .companion-pet[data-animal="robot"] .companion-pet-animation {
      animation: pixelPulse 1.2s ease-in-out infinite;
      image-rendering: pixelated;
      image-rendering: -moz-crisp-edges;
      image-rendering: crisp-edges;
    }

    /* 8bitÂãïÁï´ÈóúÈçµÂπÄ - Ë∑≥Ë∫ç */
    @keyframes pixelBounce {
      0%, 100% {
        transform: translateY(0) scale(1);
      }
      50% {
        transform: translateY(-12px) scale(1.1);
      }
    }

    /* 8bitÂãïÁï´ÈóúÈçµÂπÄ - ÊêñÊì∫ */
    @keyframes pixelSway {
      0%, 100% {
        transform: rotate(-8deg) translateY(0);
      }
      50% {
        transform: rotate(8deg) translateY(-6px);
      }
    }

    /* 8bitÂãïÁï´ÈóúÈçµÂπÄ - ÊóãËΩâË∑≥Ë∫ç */
    @keyframes pixelRotateBounce {
      0%, 100% {
        transform: translateY(0) rotate(0deg) scale(1);
      }
      25% {
        transform: translateY(-10px) rotate(-15deg) scale(1.05);
      }
      75% {
        transform: translateY(-10px) rotate(15deg) scale(1.05);
      }
    }

    /* 8bitÂãïÁï´ÈóúÈçµÂπÄ - ‰∏ä‰∏ãÊµÆÂãï */
    @keyframes pixelFloat {
      0%, 100% {
        transform: translateY(0);
      }
      50% {
        transform: translateY(-10px);
      }
    }

    /* 8bitÂãïÁï´ÈóúÈçµÂπÄ - Â∑¶Âè≥ÊêñÊì∫ */
    @keyframes pixelShake {
      0%, 100% {
        transform: translateX(0) rotate(0deg);
      }
      25% {
        transform: translateX(-6px) rotate(-5deg);
      }
      75% {
        transform: translateX(6px) rotate(5deg);
      }
    }

    /* 8bitÂãïÁï´ÈóúÈçµÂπÄ - ËÑàË°ù */
    @keyframes pixelPulse {
      0%, 100% {
        transform: scale(1);
        opacity: 1;
      }
      50% {
        transform: scale(1.2);
        opacity: 0.9;
      }
    }

    /* 8bitÂÉèÁ¥†ÂåñÊïàÊûúÔºà‰ΩøÁî®ÊøæÈè°Ôºâ */
    .companion-pet-animation {
      filter: contrast(1.2) brightness(1.1);
      image-rendering: pixelated;
      image-rendering: -moz-crisp-edges;
      image-rendering: crisp-edges;
    }

    .clicks-display {
      font-size: 64px;
      font-weight: bold;
      color: #28a745;
      margin: 25px 0;
      text-shadow: 0 2px 8px rgba(40, 167, 69, 0.3);
      letter-spacing: 1px;
    }

    .game-controls {
      margin: 20px 0;
    }

    .btn {
      padding: 12px 24px;
      font-size: 16px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: background 0.3s;
      margin: 5px;
    }

    .btn-primary {
      background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
      color: white;
      font-weight: bold;
      box-shadow: 0 4px 15px rgba(255, 107, 53, 0.4),
                  0 2px 5px rgba(0, 0, 0, 0.2);
      border: 2px solid rgba(255, 255, 255, 0.3);
      transition: all 0.3s ease;
    }

    .btn-primary:hover {
      background: linear-gradient(135deg, #ff5722 0%, #ff8c00 100%);
      box-shadow: 0 6px 20px rgba(255, 107, 53, 0.6),
                  0 4px 10px rgba(0, 0, 0, 0.3);
      transform: translateY(-2px);
    }

    .btn-primary:active {
      transform: translateY(0);
      box-shadow: 0 2px 10px rgba(255, 107, 53, 0.4),
                  0 1px 3px rgba(0, 0, 0, 0.2);
    }

    .btn-success {
      background: #28a745;
      color: white;
    }

    .btn-success:hover {
      background: #218838;
    }

    /* ÂïÜÂ∫óÂíåÊàêÂ∞±ÊåâÈàïÊ®£Âºè - ‰ΩøÁî®ËóçËâ≤Á≥ª‰ª•ÊèêÂçá emoji ÂèØË¶ãÂ∫¶ */
    .btn-shop {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      font-weight: bold;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4),
                  0 2px 5px rgba(0, 0, 0, 0.2);
      border: 2px solid rgba(255, 255, 255, 0.3);
      transition: all 0.3s ease;
    }

    .btn-shop:hover {
      background: linear-gradient(135deg, #5568d3 0%, #6a3d8f 100%);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6),
                  0 4px 10px rgba(0, 0, 0, 0.3);
      transform: translateY(-2px);
    }

    .btn-shop:active {
      transform: translateY(0);
      box-shadow: 0 2px 10px rgba(102, 126, 234, 0.4),
                  0 1px 3px rgba(0, 0, 0, 0.2);
    }

    .btn-achievement {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      color: white;
      font-weight: bold;
      box-shadow: 0 4px 15px rgba(245, 87, 108, 0.4),
                  0 2px 5px rgba(0, 0, 0, 0.2);
      border: 2px solid rgba(255, 255, 255, 0.3);
      transition: all 0.3s ease;
    }

    .btn-achievement:hover {
      background: linear-gradient(135deg, #e081f0 0%, #e0455a 100%);
      box-shadow: 0 6px 20px rgba(245, 87, 108, 0.6),
                  0 4px 10px rgba(0, 0, 0, 0.3);
      transform: translateY(-2px);
    }

    .btn-achievement:active {
      transform: translateY(0);
      box-shadow: 0 2px 10px rgba(245, 87, 108, 0.4),
                  0 1px 3px rgba(0, 0, 0, 0.2);
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .shop-items {
      display: grid;
      gap: 15px;
    }

    .shop-item {
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      padding: 15px;
      transition: border-color 0.3s;
    }

    .shop-item:hover {
      border-color: #667eea;
    }

    .shop-item-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .shop-item-name {
      font-weight: bold;
      font-size: 18px;
    }

    .shop-item-level {
      background: #667eea;
      color: white;
      padding: 5px 10px;
      border-radius: 5px;
      font-size: 14px;
    }

    .shop-item-description {
      color: #666;
      margin-bottom: 10px;
      font-size: 14px;
    }

    .shop-item-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .shop-item-price {
      font-weight: bold;
      color: #f59e0b;
      font-size: 18px;
    }

    .shop-item.disabled {
      opacity: 0.5;
      background: #f5f5f5;
      border-color: #ccc;
    }

    .shop-item.disabled:hover {
      border-color: #ccc;
    }

    .shop-item.disabled .shop-item-name {
      color: #999;
    }

    .shop-item.disabled .shop-item-level {
      background: #999;
    }

    .shop-item.disabled .shop-item-description {
      color: #999;
    }

    .shop-item.disabled .shop-item-price {
      color: #999;
    }

    .shop-item-requirement {
      color: #dc3545;
      font-size: 12px;
      margin-top: 8px;
      font-weight: bold;
    }

    .achievements-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 15px;
    }

    .achievement-card {
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      padding: 15px;
      text-align: center;
      transition: all 0.3s;
    }

    .achievement-card.unlocked {
      border-color: #28a745;
      background: #f0fff4;
    }

    .achievement-icon {
      font-size: 48px;
      margin-bottom: 10px;
    }

    .achievement-name {
      font-weight: bold;
      margin-bottom: 5px;
    }

    .achievement-description {
      font-size: 12px;
      color: #666;
    }

    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(4px);
      animation: fadeIn 0.3s ease-in-out;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }

    .modal-content {
      animation: slideUp 0.3s ease-out;
    }

    @keyframes slideUp {
      from {
        transform: translateY(30px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background: white;
      padding: 0;
      border-radius: 10px;
      max-width: 500px;
      width: 90%;
      max-height: 80vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    /* ÂïÜÂ∫óÊ®°ÊÖãÊ°ÜÁâπÊÆäÊ®£ÂºèÔºöÊ®ôÈ°åÂõ∫ÂÆöÂú®È†ÇÈÉ® */
    #shopModal .modal-content {
      padding: 0;
    }

    #shopModal .modal-header {
      position: sticky;
      top: 0;
      background: white;
      z-index: 10;
      padding: 30px 30px 20px 30px;
      margin-bottom: 0;
      border-bottom: 1px solid #e0e0e0;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }

    #shopModal #shopItemsContainer {
      flex: 1;
      overflow-y: auto;
      padding: 20px 30px 30px 30px;
    }

    /* ËºâÂÖ•‰∏≠Ê®°ÊÖãÊ°ÜÊ®£Âºè */
    .loading-modal .modal-content {
      text-align: center;
      padding: 40px;
      max-width: 300px;
    }

    .loading-spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #667eea;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .loading-text {
      font-size: 16px;
      color: #667eea;
      margin-top: 10px;
    }

    .loading-details {
      font-size: 14px;
      color: #666;
      margin-top: 10px;
      line-height: 1.5;
    }

    /* Ë≥ºË≤∑ÊàêÂäüÈÄöÁü• Toast */
    .purchase-toast {
      position: fixed;
      top: 20px;
      right: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px 30px;
      border-radius: 12px;
      box-shadow: 0 8px 24px rgba(102, 126, 234, 0.4);
      z-index: 2000;
      display: flex;
      align-items: center;
      gap: 15px;
      min-width: 300px;
      max-width: 400px;
      transform: translateX(500px);
      opacity: 0;
      transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      pointer-events: none;
    }

    /* ÈåØË™§ÊèêÁ§∫ Toast */
    .error-toast {
      position: fixed;
      top: 20px;
      right: 20px;
      background: linear-gradient(135deg, #f56565 0%, #c53030 100%);
      color: white;
      padding: 20px 30px;
      border-radius: 12px;
      box-shadow: 0 8px 24px rgba(245, 101, 101, 0.4);
      z-index: 2000;
      display: flex;
      align-items: center;
      gap: 15px;
      min-width: 300px;
      max-width: 400px;
      transform: translateX(500px);
      opacity: 0;
      transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      pointer-events: none;
    }

    .error-toast.show {
      transform: translateX(0);
      opacity: 1;
      pointer-events: auto;
    }

    .error-toast-icon {
      font-size: 32px;
      line-height: 1;
      animation: shake 0.5s ease-in-out;
    }

    @keyframes shake {
      0%, 100% {
        transform: translateX(0);
      }
      25% {
        transform: translateX(-5px);
      }
      75% {
        transform: translateX(5px);
      }
    }

    .error-toast-content {
      flex: 1;
    }

    .error-toast-title {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 5px;
    }

    .error-toast-message {
      font-size: 14px;
      opacity: 0.95;
      line-height: 1.5;
    }

    .error-toast-close {
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s;
      flex-shrink: 0;
    }

    .error-toast-close:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: rotate(90deg);
    }

    @media (max-width: 768px) {
      .error-toast {
        top: 10px;
        right: 10px;
        left: 10px;
        min-width: auto;
        max-width: none;
      }
    }

    /* ÈÅäÊà≤ÁµêÁÆó Toast */
    .game-result-toast {
      position: fixed;
      top: 20px;
      right: 20px;
      background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
      color: white;
      padding: 20px 30px;
      border-radius: 12px;
      box-shadow: 0 8px 24px rgba(72, 187, 120, 0.4);
      z-index: 2000;
      display: flex;
      align-items: center;
      gap: 15px;
      min-width: 300px;
      max-width: 400px;
      transform: translateX(500px);
      opacity: 0;
      transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      pointer-events: none;
    }

    .game-result-toast.show {
      transform: translateX(0);
      opacity: 1;
      pointer-events: auto;
    }

    .game-result-toast-icon {
      font-size: 32px;
      line-height: 1;
      animation: bounce 0.6s ease-in-out;
    }

    .game-result-toast-content {
      flex: 1;
    }

    .game-result-toast-title {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 10px;
    }

    .game-result-toast-message {
      font-size: 14px;
      opacity: 0.95;
      line-height: 1.8;
    }

    .result-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 5px;
    }

    .result-label {
      opacity: 0.9;
    }

    .result-value {
      font-weight: bold;
      font-size: 16px;
    }

    .result-value.coins-value {
      color: #ffd700;
      font-size: 18px;
    }

    .result-loading {
      margin-top: 8px;
      padding-top: 8px;
      border-top: 1px solid rgba(255, 255, 255, 0.2);
    }

    .game-result-toast-close {
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s;
      flex-shrink: 0;
    }

    .game-result-toast-close:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: rotate(90deg);
    }

    @media (max-width: 768px) {
      .game-result-toast {
        top: 10px;
        right: 10px;
        left: 10px;
        min-width: auto;
        max-width: none;
      }
    }

    .purchase-toast.show {
      transform: translateX(0);
      opacity: 1;
      pointer-events: auto;
    }

    .purchase-toast-icon {
      font-size: 32px;
      line-height: 1;
      animation: bounce 0.6s ease-in-out;
    }

    @keyframes bounce {
      0%, 100% {
        transform: scale(1);
      }
      50% {
        transform: scale(1.2);
      }
    }

    .purchase-toast-content {
      flex: 1;
    }

    .purchase-toast-title {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 5px;
    }

    .purchase-toast-message {
      font-size: 14px;
      opacity: 0.95;
    }

    .purchase-toast-close {
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s;
      flex-shrink: 0;
    }

    .purchase-toast-close:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: rotate(90deg);
    }

    @media (max-width: 768px) {
      .purchase-toast {
        top: 10px;
        right: 10px;
        left: 10px;
        min-width: auto;
        max-width: none;
      }
    }

    /* Ê≠∑Âè≤Ë®òÈåÑÊ®°ÊÖãÊ°Ü‰ΩøÁî®Êõ¥Â§ßÁöÑÂØ¨Â∫¶ */
    #historyModal .modal-content {
      max-width: 750px;
    }

    /* ÂæΩÁ´†ÈÅ∏ÊìáÊ®°ÊÖãÊ°ÜÁâπÂÆöÊ®£Âºè - Â¢ûÂä†ÂØ¨Â∫¶ÂíåÈ´òÂ∫¶ */
    .badge-select-modal-content {
      max-width: 800px;
      width: 85%;
      max-height: 85vh;
    }

    /* ÁæéÂåñÁ¢∫Ë™çÂ∞çË©±Ê°ÜÊ®£Âºè */
    .confirm-modal-content {
      text-align: center;
      max-width: 400px;
      padding: 40px 30px;
    }

    .confirm-icon {
      font-size: 64px;
      margin-bottom: 20px;
      animation: pulse 1.5s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% {
        transform: scale(1);
      }
      50% {
        transform: scale(1.1);
      }
    }

    .confirm-title {
      font-size: 24px;
      font-weight: bold;
      color: #333;
      margin-bottom: 15px;
    }

    .confirm-message {
      font-size: 16px;
      color: #666;
      line-height: 1.6;
      margin-bottom: 30px;
    }

    .confirm-buttons {
      display: flex;
      gap: 15px;
      justify-content: center;
    }

    .btn-secondary {
      background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e0 100%);
      color: #4a5568;
      border: none;
      padding: 12px 30px;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: 500;
    }

    .btn-secondary:hover {
      background: linear-gradient(135deg, #cbd5e0 0%, #a0aec0 100%);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    /* ÁæéÂåñÊèêÁ§∫Â∞çË©±Ê°ÜÊ®£Âºè */
    .alert-modal-content {
      text-align: center;
      max-width: 400px;
      padding: 40px 30px;
    }

    .alert-icon {
      font-size: 64px;
      margin-bottom: 20px;
      animation: bounce 0.6s ease-in-out;
    }

    .alert-title {
      font-size: 24px;
      font-weight: bold;
      color: #333;
      margin-bottom: 15px;
    }

    .alert-message {
      font-size: 16px;
      color: #666;
      line-height: 1.6;
      margin-bottom: 30px;
    }

    .alert-buttons {
      display: flex;
      justify-content: center;
    }

    /* ÁæéÂåñÊàêÂ∞±Ëß£ÈéñÈÄöÁü• */
    #achievementNotification .modal-content {
      text-align: center;
      max-width: 450px;
      padding: 40px 30px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      box-shadow: 0 10px 40px rgba(102, 126, 234, 0.4);
    }

    .achievement-icon {
      font-size: 80px;
      margin-bottom: 20px;
      animation: bounce 0.8s ease-in-out;
      filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.2));
    }

    #achievementNotification h2 {
      font-size: 28px;
      font-weight: bold;
      margin-bottom: 15px;
      color: white;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    #achievementNotification p {
      font-size: 16px;
      line-height: 1.6;
      margin-bottom: 30px;
      opacity: 0.95;
    }

    #achievementNotification .btn-primary {
      background: rgba(255, 255, 255, 0.2);
      border: 2px solid rgba(255, 255, 255, 0.5);
      color: white;
      padding: 12px 40px;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: 500;
    }

    #achievementNotification .btn-primary:hover {
      background: rgba(255, 255, 255, 0.3);
      border-color: rgba(255, 255, 255, 0.7);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    /* ÊàêÂ∞±Ê®°ÊÖãÊ°ÜÁâπÊÆäÊ®£ÂºèÔºöÊ®ôÈ°åÂõ∫ÂÆöÂú®È†ÇÈÉ®ÔºàËàáÂïÜÂ∫óÁõ∏ÂêåÔºâ */
    #achievementsModal .modal-content {
      padding: 0;
    }

    #achievementsModal .modal-header {
      position: sticky;
      top: 0;
      background: white;
      z-index: 10;
      padding: 30px 30px 20px 30px;
      margin-bottom: 0;
      border-bottom: 1px solid #e0e0e0;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }

    #achievementsModal #achievementsContainer {
      flex: 1;
      overflow-y: auto;
      padding: 20px 30px 30px 30px;
    }

    /* ÈÅäÊà≤Ë™™ÊòéÊ®°ÊÖãÊ°ÜÁâπÊÆäÊ®£ÂºèÔºöÊ®ôÈ°åÂõ∫ÂÆöÂú®È†ÇÈÉ®ÔºàËàáÂïÜÂ∫óÁõ∏ÂêåÔºâ */
    #gameHelpModal .modal-content {
      padding: 0;
    }

    #gameHelpModal .modal-header {
      position: sticky;
      top: 0;
      background: white;
      z-index: 10;
      padding: 30px 30px 20px 30px;
      margin-bottom: 0;
      border-bottom: 1px solid #e0e0e0;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }

    #gameHelpModal #gameHelpContainer {
      flex: 1;
      overflow-y: auto;
    }

    /* ÂÖ∂‰ªñÊ®°ÊÖãÊ°Ü‰øùÊåÅÂéüÊúâÊ®£ÂºèÔºàÊúâËá™Â∑± padding ÁöÑÊ®°ÊÖãÊ°Ü‰∏çÂèóÂΩ±ÈüøÔºâ */
    .loading-modal .modal-content {
      padding: 40px;
    }

    /* Áé©ÂÆ∂Ë≥áÊñôÊ®°ÊÖãÊ°Ü */
    #accountModal .modal-content {
      padding: 30px;
      overflow-y: auto;
    }

    /* Ê≠∑Âè≤Ë®òÈåÑÊ®°ÊÖãÊ°Ü */
    #historyModal .modal-content {
      padding: 30px;
      overflow-y: auto;
    }

    /* ÊàêÂ∞±ÈÄöÁü•Ê®°ÊÖãÊ°Ü */
    #achievementNotification .modal-content {
      padding: 30px;
    }

    .close-btn {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: #666;
    }

    .tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      border-bottom: 2px solid #e0e0e0;
    }

    .tab {
      padding: 10px 20px;
      background: none;
      border: none;
      cursor: pointer;
      font-size: 16px;
      color: #666;
      border-bottom: 3px solid transparent;
      transition: all 0.3s;
    }

    .tab.active {
      color: #667eea;
      border-bottom-color: #667eea;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    .auto-clicker-info {
      background: #f0f0f0;
      padding: 10px;
      border-radius: 5px;
      margin: 10px 0;
      font-size: 14px;
    }

    /* Ë∂ÖÁ¥öÂ∏≥ËôüÊôÇÈñìË™øÊï¥Ê¨Ñ‰Ωç */
    .super-account-controls {
      background: linear-gradient(135deg, #f5f5f5 0%, #e8e8e8 100%);
      padding: 15px;
      border-radius: 10px;
      margin: 15px 0;
      border: 1px solid #d0d0d0;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
      width: 80%;
      max-width: 800px;
    }

    .super-account-controls .controls-row {
      display: flex;
      gap: 20px;
      align-items: flex-start;
    }

    .super-account-controls .controls-row > div {
      flex: 1;
      min-width: 0;
    }

    .super-account-controls h3 {
      margin: 0 0 10px 0;
      color: #666666;
      font-size: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .super-account-controls .time-control {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .super-account-controls .time-control-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }

    .super-account-controls label {
      font-weight: bold;
      color: #555555;
      font-size: 14px;
      margin: 0;
    }

    .super-account-controls .range-container {
      position: relative;
      width: 100%;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .super-account-controls .range-label {
      font-size: 12px;
      color: #666666;
      font-weight: bold;
      white-space: nowrap;
      min-width: 40px;
    }

    .super-account-controls input[type="range"] {
      flex: 1;
      height: 4px;
      border-radius: 2px;
      background: white;
      outline: none;
      -webkit-appearance: none;
      margin: 0;
    }

    .super-account-controls input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: #888888;
      cursor: pointer;
      border: 2px solid #aaaaaa;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
      transition: all 0.3s;
    }

    .super-account-controls input[type="range"]::-webkit-slider-thumb:hover {
      background: #666666;
      transform: scale(1.1);
      box-shadow: 0 3px 6px rgba(0, 0, 0, 0.2);
    }

    .super-account-controls input[type="range"]::-moz-range-thumb {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: #888888;
      cursor: pointer;
      border: 2px solid #aaaaaa;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
      transition: all 0.3s;
    }

    .super-account-controls input[type="range"]::-moz-range-thumb:hover {
      background: #666666;
      transform: scale(1.1);
      box-shadow: 0 3px 6px rgba(0, 0, 0, 0.2);
    }

    .super-account-controls .time-value-display {
      font-size: 16px;
      font-weight: bold;
      color: #555555;
      margin: 0;
      white-space: nowrap;
    }

    .super-account-controls .shop-rollback-control {
      padding-left: 20px;
      border-left: 2px solid #d0d0d0;
    }

    .super-account-controls .time-control h4,
    .super-account-controls .shop-rollback-control h4 {
      margin: 0 0 15px 0;
      color: #666666;
      font-size: 15px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .super-account-controls .shop-item-select {
      margin-bottom: 15px;
    }

    .super-account-controls .shop-item-select label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
      color: #555555;
      font-size: 14px;
    }

    .super-account-controls .shop-item-select select {
      width: 100%;
      padding: 8px 12px;
      border: 2px solid #d0d0d0;
      border-radius: 6px;
      font-size: 14px;
      background: white;
      color: #333;
      cursor: pointer;
      transition: border-color 0.3s;
    }

    .super-account-controls .shop-item-select select:hover {
      border-color: #667eea;
    }

    .super-account-controls .shop-item-select select:focus {
      outline: none;
      border-color: #667eea;
    }

    .super-account-controls .level-control {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .super-account-controls .level-control-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }

    .super-account-controls .level-value-display {
      font-size: 14px;
      font-weight: bold;
      color: #667eea;
      background: white;
      padding: 4px 12px;
      border-radius: 6px;
      border: 1px solid #667eea;
      min-width: 60px;
      text-align: center;
    }

    .super-account-controls .rollback-button {
      width: 100%;
      padding: 10px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
      margin-top: 10px;
    }

    .super-account-controls .rollback-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(102, 126, 234, 0.3);
    }

    .super-account-controls .rollback-button:active {
      transform: translateY(0);
    }

    .super-account-controls .rollback-button:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
    }

    .super-account-controls .current-level-info {
      font-size: 12px;
      color: #888;
      margin-top: 5px;
      text-align: center;
    }

    @media (max-width: 768px) {
      body {
        padding: 8px;
      }

      .container {
        max-width: 100%;
      }

      .main-content {
        grid-template-columns: 1fr;
        gap: 12px;
        margin-bottom: 12px;
      }

      .header {
        flex-direction: column;
        text-align: center;
        padding: 12px;
        gap: 8px;
        margin-bottom: 12px;
        border-radius: 8px;
      }

      .header h1 {
        font-size: 24px;
        margin-bottom: 8px;
      }

      .user-info {
        flex-direction: row;
        flex-wrap: wrap;
        width: 100%;
        gap: 8px;
        justify-content: center;
        align-items: center;
      }

      .stat-item {
        font-size: 13px;
        gap: 4px;
        padding: 4px 8px;
        background: #f8f9fa;
        border-radius: 6px;
      }

      .coins {
        font-size: 18px;
      }

      .panel {
        padding: 12px;
        border-radius: 8px;
      }

      .panel h2 {
        font-size: 18px;
        margin-bottom: 10px;
      }

      .game-container {
        min-height: auto;
        padding: 8px;
        position: relative;
      }

      .badges-container-game {
        top: 8px;
        right: 8px;
        gap: 4px;
      }

      .badges-label {
        font-size: 10px;
        padding: 2px 6px;
      }

      .badge-slot {
        width: 36px;
        height: 36px;
        border-radius: 6px;
      }

      .badge-icon {
        font-size: 20px;
      }

      .game-container h2 {
        font-size: 18px;
        margin: 8px 0 12px 0;
      }

      .super-account-controls {
        width: 100%;
        padding: 10px;
        margin: 10px 0;
        border-radius: 8px;
      }

      .super-account-controls .controls-row {
        flex-direction: column;
        gap: 12px;
      }

      .super-account-controls .shop-rollback-control {
        padding-left: 0;
        border-left: none;
        padding-top: 12px;
        border-top: 2px solid #d0d0d0;
      }

      .username-display {
        margin-right: 0;
        margin-bottom: 0;
        font-size: 14px;
        padding: 5px 10px;
      }

      .settings-container {
        margin-left: 0;
        margin-top: 0;
      }

      .settings-btn {
        font-size: 13px;
        padding: 5px 10px;
      }

      .settings-dropdown {
        right: 0;
        left: auto;
        min-width: 120px;
        max-width: calc(100vw - 60px);
        white-space: nowrap;
      }

      .click-button {
        padding: 40px 30px;
        font-size: 20px;
        min-width: 100%;
        width: 100%;
        max-width: 100%;
        /* ÊâãÊ©ü‰∏äÊõ¥Â§ßÁöÑËß∏ÊéßÂçÄÂüü */
        min-height: 80px;
        border-radius: 16px;
        box-shadow: 0 6px 16px rgba(102, 126, 234, 0.4),
                    0 3px 6px rgba(0, 0, 0, 0.1);
      }

      .click-buttons-container {
        gap: 8px; /* Ê∏õÂ∞ëÈñìË∑ù */
        margin: 12px 0 3px 0; /* Ê∏õÂ∞ëÂ∫ïÈÉ®ÈñìË∑ù */
        padding: 0 4px;
      }

      .companion-pets-wrapper {
        gap: 12px;
        width: 100%;
        justify-content: center;
        padding: 15px;
        margin: 3px 0 15px 0; /* Ê∏õÂ∞ëÈ†ÇÈÉ®ÈñìË∑ùÔºåËÆìÂØµÁâ©Êõ¥Èù†ËøëÊåâÈàï */
      }

      .companion-pet {
        width: 90px;
        height: 90px;
      }

      .companion-pet-animation {
        font-size: 50px;
      }

      .companion-pet-name {
        font-size: 10px;
        padding: 3px 6px;
      }

      .companion-pet-level {
        font-size: 9px;
        padding: 2px 4px;
      }

      .timer {
        font-size: 32px;
        margin: 45px 0 10px 0;
        font-weight: bold;
        color: #667eea;
      }

      .clicks-display {
        font-size: 48px;
        margin: 15px 0;
        line-height: 1.2;
      }

      .game-controls {
        margin: 12px 0;
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
        justify-content: center;
      }

      .btn {
        padding: 10px 16px;
        font-size: 14px;
        margin: 0;
        flex: 1;
        min-width: calc(33.333% - 4px);
        max-width: calc(33.333% - 4px);
        border-radius: 8px;
      }

      .auto-clicker-info {
        font-size: 12px;
        padding: 8px;
        margin: 8px 0;
        border-radius: 6px;
        text-align: center;
      }

      .modal-content {
        padding: 16px;
        width: 95%;
        max-height: 85vh;
        border-radius: 12px;
      }

      .modal-header {
        margin-bottom: 15px;
      }

      .modal-header h2 {
        font-size: 18px;
      }

      .shop-item {
        padding: 12px;
        border-radius: 8px;
      }

      .shop-item-name {
        font-size: 16px;
      }

      .achievements-grid {
        grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
        gap: 10px;
      }

      .achievement-icon {
        font-size: 32px;
      }

      .login-panel {
        padding: 25px 15px;
      }

      .login-panel h2 {
        font-size: 20px;
        margin-bottom: 15px;
      }

      .login-panel input {
        width: 100%;
        max-width: 100%;
        margin-right: 0;
        margin-bottom: 10px;
        padding: 14px;
        font-size: 16px;
        /* ÂÖÅË®±Ëº∏ÂÖ•Ê°ÜÈÅ∏ÊìáÊñáÂ≠ó */
        user-select: text;
        -webkit-user-select: text;
      }

      .login-panel button {
        width: 100%;
        max-width: 100%;
        padding: 14px;
        font-size: 16px;
      }

      /* Ê≠∑Âè≤Ë®òÈåÑÈù¢ÊùøÂÑ™Âåñ */
      .panel:has(#historyContainer) {
        padding: 10px;
      }

      #historyContainer table {
        font-size: 12px;
      }

      #historyContainer th,
      #historyContainer td {
        padding: 6px 4px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ClickFast <span style="position: relative; display: inline-block;">‚ö°<button class="game-help-btn" onclick="openGameHelp()" title="ÈÅäÊà≤Ë™™Êòé">?</button></span></h1>
      <div class="user-info" id="userInfo" style="display: none;">
        <div class="stat-item">
          <span>üí∞</span>
          <span class="coins" id="coinsDisplay">0</span>
        </div>
        <div class="stat-item">
          <strong>Á∏ΩÈªûÊìä:</strong> <span id="totalClicksDisplay">0</span>
        </div>
        <div class="stat-item">
          <strong>ÊúÄ‰Ω≥:</strong> <span id="bestClicksDisplay">0</span>
        </div>
        <div class="stat-item">
          <strong>ÈÅäÊà≤Êï∏:</strong> <span id="gamesPlayedDisplay">0</span>
        </div>
        <div style="display: flex; align-items: center; gap: 10px; margin-left: auto;">
          <div class="username-display" id="usernameDisplay" onclick="openAccount()">ID: Â∏≥ËôüÂêçÁ®±</div>
          <div class="settings-container">
            <button class="settings-btn" onclick="toggleSettings()">
              ‚öôÔ∏è Ë®≠ÂÆö
            </button>
            <div class="settings-dropdown" id="settingsDropdown">
              <div class="settings-dropdown-item" onclick="openHistory(); closeSettings();">üìä Ê≠∑Âè≤Ë®òÈåÑ</div>
              <div class="settings-dropdown-item logout" onclick="logoutUser(); closeSettings();">üö™ ÁôªÂá∫</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="loginPanel" class="panel login-panel">
      <h2>Ê≠°Ëøé‰æÜÂà∞ ClickFastÔºÅ</h2>
      <p style="margin: 20px 0;">Ë´ãËº∏ÂÖ•Áî®Êà∂ÂêçÈñãÂßãÈÅäÊà≤</p>
      <div>
        <input type="text" id="usernameInput" placeholder="Ëº∏ÂÖ•Áî®Êà∂Âêç" maxlength="20">
        <button onclick="loginOrRegister()">ÈñãÂßãÈÅäÊà≤</button>
      </div>
    </div>

    <div id="gameContent" style="display: none;">
      <div class="main-content">
        <div class="panel game-area">
          <div class="game-container">
            <!-- ÊàêÂ∞±ÂæΩÁ´†È°ØÁ§∫ÂçÄÂüüÔºàÂè≥‰∏äËßíÔºâ -->
            <div class="badges-container-game">
              <div class="badges-label" title="ÈªûÊìä‰∏ãÊñπÂæΩÁ´†ÊßΩ‰ΩçÂèØÈÅ∏ÊìáË¶ÅÈ°ØÁ§∫ÁöÑÊàêÂ∞±ÂæΩÁ´†">üèÖ ÊàêÂ∞±ÂæΩÁ´†</div>
              <div class="badges-slots-container">
                <div class="badge-slot" id="badgeSlot1" onclick="selectBadge(1)" title="ÈªûÊìäÈÅ∏ÊìáÂæΩÁ´†">
                  <span class="badge-icon" id="badgeIcon1">-</span>
                </div>
                <div class="badge-slot" id="badgeSlot2" onclick="selectBadge(2)" title="ÈªûÊìäÈÅ∏ÊìáÂæΩÁ´†">
                  <span class="badge-icon" id="badgeIcon2">-</span>
                </div>
                <div class="badge-slot" id="badgeSlot3" onclick="selectBadge(3)" title="ÈªûÊìäÈÅ∏ÊìáÂæΩÁ´†">
                  <span class="badge-icon" id="badgeIcon3">-</span>
                </div>
              </div>
            </div>
            <h2>ÈªûÊìäÈÅäÊà≤</h2>
            <!-- Ë∂ÖÁ¥öÂ∏≥ËôüÊôÇÈñìË™øÊï¥Ê¨Ñ‰Ωç -->
            <div class="super-account-controls" id="superAccountControls" style="display: none;">
              <h3>üëë Ë∂ÖÁ¥öÂ∏≥ËôüÊéßÂà∂Èù¢Êùø</h3>
              <div class="controls-row">
                <div class="time-control">
                  <h4>‚è±Ô∏è ÈÅäÊà≤ÊôÇÈï∑</h4>
                  <div class="time-control-header">
                    <label for="superTimeInput">ÈÅäÊà≤ÊôÇÈï∑Ôºö</label>
                    <div class="time-value-display" id="superTimeDisplay">5 Áßí</div>
                  </div>
                  <div class="range-container">
                    <span class="range-label">5(Áßí)</span>
                    <input type="range" id="superTimeInput" min="5" max="30" step="1" value="5">
                    <span class="range-label">30(Áßí)</span>
                  </div>
                </div>
                <!-- ÂïÜÂ∫óÁ≠âÁ¥öÂõûÊ∫ØÊéßÂà∂ -->
                <div class="shop-rollback-control">
                  <h4>üîÑ ÂïÜÂ∫óÁ≠âÁ¥öÂõûÊ∫Ø</h4>
                  <p style="font-size: 12px; color: #888; margin-bottom: 15px; text-align: center;">
                    Â∞áÊâÄÊúâÂïÜÂ∫óÁâ©ÂìÅÂõûÊ∫ØÂà∞ÂàùÂßãÁãÄÊÖãÔºàÁ≠âÁ¥ö 0Ôºâ
                  </p>
                  <button class="rollback-button" id="rollbackAllButton" onclick="rollbackAllShopItems()">
                    üîÑ ÂÖ®ÈÉ®ÂõûÊ∫Ø
                  </button>
                </div>
              </div>
            </div>
            <div class="timer" id="timerDisplay">5.0 Áßí</div>
            <div class="clicks-display" id="clicksDisplay">0 Ê¨°ÈªûÊìä</div>
            <div class="game-controls">
              <button class="btn btn-primary" id="startButton" onclick="startGame()">ÈñãÂßãÈÅäÊà≤</button>
              <button class="btn btn-shop" onclick="openShop()">üõí ÂïÜÂ∫ó</button>
              <button class="btn btn-achievement" onclick="openAchievements()">üèÜ ÊàêÂ∞±</button>
            </div>
            <div class="click-buttons-container" id="clickButtonsContainer">
              <button class="click-button" id="mainClickButton" onclick="handleClick()" disabled>
                <span class="button-text">ÈªûÊìäÔºÅ</span>
              </button>
            </div>
            <div class="auto-clicker-info" id="autoClickerInfo" style="display: none;">
              ‚ú® ÂØµÁâ©Â§•‰º¥ÈªûÊìäËÉΩÂäõ: <span id="autoClickerRatePerButton">0</span> Ê¨°/Áßí √ó <span id="autoClickerCount">0</span> ÂÄã = <span id="autoClickerTotalRate">0</span> Ê¨°/Áßí
            </div>
          </div>
        </div>

        <div class="panel">
          <h2>ÊúÄËøëË®òÈåÑ</h2>
          <div id="historyContainer">
            <p style="color: #666;">Êö´ÁÑ°Ë®òÈåÑ</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ÂïÜÂ∫óÊ®°ÊÖãÊ°Ü -->
  <div class="modal" id="shopModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>ÂïÜÂ∫ó üõí</h2>
        <button class="close-btn" onclick="closeShop()">&times;</button>
      </div>
      <div id="shopItemsContainer"></div>
    </div>
  </div>

  <!-- ÊàêÂ∞±Ê®°ÊÖãÊ°Ü -->
  <div class="modal" id="achievementsModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>ÊàêÂ∞± üèÜ</h2>
        <button class="close-btn" onclick="closeAchievements()">&times;</button>
      </div>
      <div id="achievementsContainer"></div>
    </div>
  </div>

  <!-- ÈÅäÊà≤Ë™™ÊòéÊ®°ÊÖãÊ°Ü -->
  <div class="modal" id="gameHelpModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>üìñ ÈÅäÊà≤Ë™™Êòé</h2>
        <button class="close-btn" onclick="closeGameHelp()">&times;</button>
      </div>
      <div id="gameHelpContainer" style="padding: 20px 30px 30px 30px; overflow-y: auto; max-height: 70vh;">
        <div style="line-height: 1.8; color: #333;">
          <h3 style="color: #667eea; margin-top: 0; margin-bottom: 15px;">üéÆ ÈÅäÊà≤Áé©Ê≥ï</h3>
          <ol style="margin-left: 20px; margin-bottom: 25px;">
            <li><strong>ÁôªÂÖ•/Ë®ªÂÜä</strong>ÔºöËº∏ÂÖ•‰ΩøÁî®ËÄÖÂêçÁ®±ÈñãÂßãÈÅäÊà≤ÔºàÈ¶ñÊ¨°Ëº∏ÂÖ•ÊúÉËá™ÂãïÂâµÂª∫Â∏≥ËôüÔºâ</li>
            <li><strong>ÈªûÊìäÊåëÊà∞</strong>ÔºöÈªûÊìä„ÄåÈñãÂßãÈÅäÊà≤„ÄçÊåâÈàïÔºåÂú®ÈôêÂÆöÊôÇÈñìÂÖßÁõ°ÂèØËÉΩÂ§öÂú∞ÈªûÊìä</li>
            <li><strong>Ë≥∫ÂèñÈáëÂπ£</strong>Ôºö
              <ul style="margin-top: 5px; margin-left: 20px;">
                <li>Âü∫Á§éÊôÇÈñìÔºà5ÁßíÔºâÂÖßÔºöÊØèÊ¨°ÈªûÊìä1ÈáëÂπ£</li>
                <li>Âª∂Èï∑ÊôÇÈñìÂÖßÔºöÊØèÊ¨°ÈªûÊìä2ÈáëÂπ£</li>
              </ul>
            </li>
            <li><strong>Ë≥ºË≤∑ÂçáÁ¥ö</strong>ÔºöÂú®ÂïÜÂ∫óË≥ºË≤∑ÂçáÁ¥ö‰æÜÊèêÂçáÈÅäÊà≤È´îÈ©ó</li>
            <li><strong>Ëß£ÈéñÊàêÂ∞±</strong>ÔºöÂÆåÊàêÂêÑÁ®ÆÊåëÊà∞Ëá™ÂãïËß£ÈéñÊàêÂ∞±‰∏¶Áç≤ÂæóÁçéÂãµÈáëÂπ£</li>
            <li><strong>ÈÅ∏ÊìáÂæΩÁ´†</strong>ÔºöÈÅ∏ÊìáÂ∑≤Ëß£ÈéñÁöÑÊàêÂ∞±‰ΩúÁÇ∫ÂæΩÁ´†È°ØÁ§∫Âú®Âè≥‰∏äËßí</li>
          </ol>

          <h3 style="color: #667eea; margin-top: 25px; margin-bottom: 15px;">üõí ÂïÜÂ∫óÁâ©ÂìÅ</h3>
          <div style="margin-bottom: 25px;">
            <p style="margin-bottom: 10px;"><strong>ÈÅäÊà≤ÊôÇÈñìÂª∂Èï∑</strong>ÔºöÊØèÊ¨°ÂçáÁ¥öÂ¢ûÂä†2ÁßíÈÅäÊà≤ÊôÇÈñìÔºàÊúÄÈ´ò10Á¥öÔºâ</p>
            <p style="margin-left: 20px; color: #666; font-size: 14px;">Âª∂Èï∑ÊôÇÈñìÂÖßÈªûÊìäÁç≤ÂæóÁöÑÈáëÂπ£ÁÇ∫Âü∫Á§éÊôÇÈñìÁöÑÂÖ©ÂÄç</p>
            
            <p style="margin-top: 15px; margin-bottom: 10px;"><strong>Ë≥ºË≤∑ÂØµÁâ©Â§•‰º¥</strong>ÔºöÊØèÊ¨°ÂçáÁ¥öÂ¢ûÂä†1ÂÄãÂØµÁâ©ÔºàÊúÄÈ´ò5Á¥öÔºâ</p>
            <p style="margin-left: 20px; color: #666; font-size: 14px;">È¶ñÊ¨°Ë≥ºË≤∑ÊôÇÊúÉËá™ÂãïÁç≤Âæó1Á≠âÁ¥öÁöÑÂØµÁâ©Â§•‰º¥ËÉΩÂäõ„ÄÇÂØµÁâ©ÊúÉËá™ÂãïÂπ´‰Ω†ÈªûÊìäÔºÅ</p>
            
            <p style="margin-top: 15px; margin-bottom: 10px;"><strong>ÊèêÂçáÂØµÁâ©Â§•‰º¥ËÉΩÂäõ</strong>ÔºöÊèêÂçáÂØµÁâ©Â§•‰º¥ÁöÑÈªûÊìäËÉΩÂäõÔºàÊúÄÈ´ò10Á¥öÔºâ</p>
            <ul style="margin-left: 20px; color: #666; font-size: 14px;">
              <li>Lv.1ÔºöÊØè3ÁßíÈªûÊìä1Ê¨°</li>
              <li>Lv.2ÔºöÊØè2ÁßíÈªûÊìä1Ê¨°</li>
              <li>Lv.3ÔºöÊØè1ÁßíÈªûÊìä1Ê¨°</li>
              <li>Lv.4+ÔºöÊØèÁßíÈªûÊìä(Á≠âÁ¥ö-2)Ê¨°</li>
            </ul>
            <p style="margin-left: 20px; color: #666; font-size: 14px; margin-top: 5px;">ÈúÄË¶ÅÂÖàË≥ºË≤∑„ÄåË≥ºË≤∑ÂØµÁâ©Â§•‰º¥„ÄçÊâçËÉΩÊèêÂçá</p>
          </div>

          <h3 style="color: #667eea; margin-top: 25px; margin-bottom: 15px;">üèÜ ÊàêÂ∞±Á≥ªÁµ±</h3>
          <div style="margin-bottom: 25px;">
            <p style="margin-bottom: 10px;"><strong>Á∏ΩÈªûÊìäÊàêÂ∞±</strong>Ôºö</p>
            <ul style="margin-left: 20px; color: #666; font-size: 14px;">
              <li>üéØ ÂàùÂá∫ËåÖÂª¨ÔºöÁ¥ØË®àÈªûÊìä100Ê¨°ÔºàÁçéÂãµ50ÈáëÂπ£Ôºâ</li>
              <li>üî• ÈªûÊìäÈÅî‰∫∫ÔºöÁ¥ØË®àÈªûÊìä1000Ê¨°ÔºàÁçéÂãµ500ÈáëÂπ£Ôºâ</li>
              <li>üëë ÈªûÊìäÂ§ßÂ∏´ÔºöÁ¥ØË®àÈªûÊìä10000Ê¨°ÔºàÁçéÂãµ5000ÈáëÂπ£Ôºâ</li>
            </ul>
            
            <p style="margin-top: 15px; margin-bottom: 10px;"><strong>ÂñÆÂ±ÄÊàêÂ∞±</strong>Ôºö</p>
            <ul style="margin-left: 20px; color: #666; font-size: 14px;">
              <li>‚ö° ÂñÆÂ±ÄÁ™ÅÁ†¥ÔºöÂñÆÂ±ÄÈªûÊìäË∂ÖÈÅé50Ê¨°ÔºàÁçéÂãµ100ÈáëÂπ£Ôºâ</li>
              <li>üí™ ÂñÆÂ±ÄÈ´òÊâãÔºöÂñÆÂ±ÄÈªûÊìäË∂ÖÈÅé100Ê¨°ÔºàÁçéÂãµ500ÈáëÂπ£Ôºâ</li>
              <li>üåü ÂñÆÂ±ÄÂÇ≥Â•áÔºöÂñÆÂ±ÄÈªûÊìäË∂ÖÈÅé200Ê¨°ÔºàÁçéÂãµ2000ÈáëÂπ£Ôºâ</li>
            </ul>
            
            <p style="margin-top: 15px; margin-bottom: 10px;"><strong>ÈÅäÊà≤Â±ÄÊï∏ÊàêÂ∞±</strong>Ôºö</p>
            <ul style="margin-left: 20px; color: #666; font-size: 14px;">
              <li>üéÆ ÈÅäÊà≤Êñ∞ÊâãÔºöÂÆåÊàê10Â±ÄÈÅäÊà≤ÔºàÁçéÂãµ100ÈáëÂπ£Ôºâ</li>
              <li>üèÖ ÈÅäÊà≤ËÄÅÊâãÔºöÂÆåÊàê50Â±ÄÈÅäÊà≤ÔºàÁçéÂãµ500ÈáëÂπ£Ôºâ</li>
              <li>üèÜ ÈÅäÊà≤Â§ßÂ∏´ÔºöÂÆåÊàê100Â±ÄÈÅäÊà≤ÔºàÁçéÂãµ2000ÈáëÂπ£Ôºâ</li>
            </ul>
          </div>

          <h3 style="color: #667eea; margin-top: 25px; margin-bottom: 15px;">üí° Â∞èÊèêÁ§∫</h3>
          <ul style="margin-left: 20px; color: #666; font-size: 14px;">
            <li>ÂØµÁâ©Â§•‰º¥ÊúÉËá™ÂãïÂπ´‰Ω†ÈªûÊìäÔºåÊèêÂçáËÉΩÂäõÁ≠âÁ¥öÂèØ‰ª•Â¢ûÂä†ÈªûÊìäÈ†ªÁéá</li>
            <li>Âª∂Èï∑ÊôÇÈñìÂÖßÈªûÊìäÁç≤ÂæóÁöÑÈáëÂπ£Êõ¥Â§öÔºåÂÑ™ÂÖàÂçáÁ¥öÊôÇÈñìÂª∂Èï∑ÂèØ‰ª•Áç≤ÂæóÊõ¥Â§öÊî∂Áõä</li>
            <li>ÂÆåÊàêÊàêÂ∞±ÂèØ‰ª•Áç≤ÂæóÂ§ßÈáèÁçéÂãµÈáëÂπ£ÔºåË®òÂæóÊü•ÁúãÊàêÂ∞±ÈÄ≤Â∫¶</li>
            <li>ÈÅ∏ÊìáÂñúÊ≠°ÁöÑÊàêÂ∞±ÂæΩÁ´†Â±ïÁ§∫Âú®Âè≥‰∏äËßíÔºåÂ±ïÁèæ‰Ω†ÁöÑÈÅäÊà≤ÊàêÂ∞±</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- ÊàêÂ∞±Ëß£ÈéñÈÄöÁü• -->
  <div class="modal" id="achievementNotification">
    <div class="modal-content" style="text-align: center;">
      <div class="achievement-icon" id="notificationIcon">üèÜ</div>
      <h2 id="notificationTitle">ÊàêÂ∞±Ëß£ÈéñÔºÅ</h2>
      <p id="notificationDescription"></p>
      <button class="btn btn-primary" onclick="closeAchievementNotification()">Á¢∫ÂÆö</button>
    </div>
  </div>

  <!-- Ë≥ºË≤∑ÊàêÂäüÈÄöÁü• Toast -->
  <div class="purchase-toast" id="purchaseToast">
    <div class="purchase-toast-icon">‚úÖ</div>
    <div class="purchase-toast-content">
      <div class="purchase-toast-title">Ë≥ºË≤∑ÊàêÂäüÔºÅ</div>
      <div class="purchase-toast-message" id="purchaseToastMessage">Áâ©ÂìÅÂ∑≤ÊàêÂäüË≥ºË≤∑</div>
    </div>
    <button class="purchase-toast-close" onclick="closePurchaseToastAndProcessNext()">&times;</button>
  </div>

  <!-- ÈåØË™§ÊèêÁ§∫ Toast -->
  <div class="error-toast" id="errorToast">
    <div class="error-toast-icon">‚ö†Ô∏è</div>
    <div class="error-toast-content">
      <div class="error-toast-title" id="errorToastTitle">ÈåØË™§</div>
      <div class="error-toast-message" id="errorToastMessage">ÁôºÁîüÈåØË™§</div>
    </div>
    <button class="error-toast-close" onclick="closeErrorToast()">&times;</button>
  </div>

  <!-- ÈÅäÊà≤ÁµêÁÆó Toast -->
  <div class="game-result-toast" id="gameResultToast">
    <div class="game-result-toast-icon">üéÆ</div>
    <div class="game-result-toast-content">
      <div class="game-result-toast-title">ÈÅäÊà≤ÁµêÊùüÔºÅ</div>
      <div class="game-result-toast-message" id="gameResultMessage">
        <div class="result-item">
          <span class="result-label">ÈªûÊìäÊï∏Ôºö</span>
          <span class="result-value" id="resultClicks">0</span>
        </div>
        <div class="result-item">
          <span class="result-label">Áç≤ÂæóÈáëÂπ£Ôºö</span>
          <span class="result-value coins-value" id="resultCoins">+0 üí∞</span>
        </div>
        <div class="result-loading" id="resultLoading" style="display: none;">
          <span style="opacity: 0.8; font-size: 12px;">Ê≠£Âú®ÂÑ≤Â≠ò...</span>
        </div>
      </div>
    </div>
    <button class="game-result-toast-close" onclick="closeGameResultToast()">&times;</button>
  </div>

  <!-- Â∏≥Ëôü‰ªãÈù¢Ê®°ÊÖãÊ°ÜÔºàÂÉÖÁé©ÂÆ∂Ë≥áÊñôÔºâ -->
  <div class="modal" id="accountModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Áé©ÂÆ∂Ë≥áÊñô üë§</h2>
        <button class="close-btn" onclick="closeAccount()">&times;</button>
      </div>
      <div id="accountContainer">
        <div id="accountProfileInfo" style="background: #f0f0f0; padding: 15px; border-radius: 5px;">
          <!-- Áé©ÂÆ∂Ë≥áÊñôÂ∞áÂú®ÈÄôË£°È°ØÁ§∫ -->
        </div>
      </div>
    </div>
  </div>

  <!-- ÂæΩÁ´†ÈÅ∏ÊìáÊ®°ÊÖãÊ°Ü -->
  <div class="modal" id="badgeSelectModal">
    <div class="modal-content badge-select-modal-content">
      <div class="modal-header">
        <h2>ÈÅ∏ÊìáÊàêÂ∞±ÂæΩÁ´†</h2>
        <button class="close-btn" onclick="closeBadgeSelect()">&times;</button>
      </div>
      <div style="padding: 20px;">
        <p style="margin-bottom: 15px; color: #666;">ÈÅ∏ÊìáË¶ÅÈ°ØÁ§∫Âú®Âè≥‰∏äËßíÁöÑÊàêÂ∞±ÂæΩÁ´†ÔºàÂÉÖÈ°ØÁ§∫Â∑≤Ëß£ÈéñÁöÑÊàêÂ∞±Ôºâ</p>
        <div id="badgeSelectContainer" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 15px; max-height: 500px; overflow-y: auto; overflow-x: hidden;">
          <!-- ÊàêÂ∞±ÂæΩÁ´†ÈÅ∏ÊìáÂàóË°®Â∞áÂú®ÈÄôË£°È°ØÁ§∫ -->
        </div>
        <div style="margin-top: 20px; text-align: center;">
          <button class="btn btn-primary" onclick="clearBadgeSlot()">Ê∏ÖÈô§Áï∂ÂâçÊ¨Ñ‰Ωç</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Ê≠∑Âè≤Ë®òÈåÑÊ®°ÊÖãÊ°Ü -->
  <div class="modal" id="historyModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>ÈÅäÊà≤Ê≠∑Âè≤Ë®òÈåÑ üìä</h2>
        <button class="close-btn" onclick="closeHistory()">&times;</button>
      </div>
      <div id="detailedHistoryContainer" style="max-height: 500px; overflow-x: auto; overflow-y: auto;">
        <!-- Ë©≥Á¥∞Ê≠∑Âè≤Ë®òÈåÑÂ∞áÂú®ÈÄôË£°È°ØÁ§∫ -->
      </div>
    </div>
  </div>

  <!-- ËºâÂÖ•‰∏≠Ê®°ÊÖãÊ°Ü -->
  <div class="modal loading-modal" id="loadingModal">
    <div class="modal-content">
      <div class="loading-spinner"></div>
      <div class="loading-text" id="loadingText">Ê≠£Âú®ËôïÁêÜ‰∏≠...</div>
      <div class="loading-details" id="loadingDetails"></div>
    </div>
  </div>

  <!-- ÁæéÂåñÁ¢∫Ë™çÂ∞çË©±Ê°Ü -->
  <div class="modal" id="confirmModal" onclick="handleModalBackgroundClick(event, 'confirmModal')">
    <div class="modal-content confirm-modal-content" onclick="event.stopPropagation()">
      <div class="confirm-icon">‚ùì</div>
      <h2 class="confirm-title" id="confirmTitle">Á¢∫Ë™ç</h2>
      <p class="confirm-message" id="confirmMessage"></p>
      <div class="confirm-buttons">
        <button class="btn btn-secondary" id="confirmCancelBtn" onclick="closeConfirmModal(false)">ÂèñÊ∂à</button>
        <button class="btn btn-primary" id="confirmOkBtn" onclick="closeConfirmModal(true)">Á¢∫ÂÆö</button>
      </div>
    </div>
  </div>

  <!-- ÁæéÂåñÊèêÁ§∫Â∞çË©±Ê°Ü -->
  <div class="modal" id="alertModal" onclick="handleModalBackgroundClick(event, 'alertModal')">
    <div class="modal-content alert-modal-content" onclick="event.stopPropagation()">
      <div class="alert-icon">‚ÑπÔ∏è</div>
      <h2 class="alert-title" id="alertTitle">ÊèêÁ§∫</h2>
      <p class="alert-message" id="alertMessage"></p>
      <div class="alert-buttons">
        <button class="btn btn-primary" id="alertOkBtn" onclick="closeAlertModal()">Á¢∫ÂÆö</button>
      </div>
    </div>
  </div>

  <script>
    // ============================================
    // Áî®Êà∂Á´ØË≥áÊñôÂÑ≤Â≠òÁÆ°ÁêÜÁ≥ªÁµ±
    // ============================================
    // Ê†πÊìöÊúÄ‰Ω≥ÂØ¶Ë∏êÔºö
    // 1. ÁôªÂÖ•ÁãÄÊÖã (Session) ‚Üí Cookie (Áî± Django Session ÁÆ°ÁêÜÔºåHTTP OnlyÔºåÊõ¥ÂÆâÂÖ®)
    // 2. ÈÅäÊà≤Ë®≠ÂÆö„ÄÅÈÄ≤Â∫¶ ‚Üí LocalStorage (Á∞°ÂñÆ„ÄÅÂø´ÈÄü„ÄÅÂÆπÈáèË∂≥Â§†)
    // 3. Ë§áÈõúË≥áÊñôÈõÜ ‚Üí IndexedDB (Êú™‰æÜÊì¥Â±ïÁî®)
    
    const StorageManager = {
      // LocalStorage ÈçµÂêçÂ∏∏Èáè
      KEYS: {
        GAME_SETTINGS: 'clickfast_game_settings',
        GAME_PROGRESS: 'clickfast_game_progress',
        LAST_USERNAME: 'clickfast_last_username', // ÂÉÖÁî®ÊñºÈ°ØÁ§∫Ôºå‰∏ç‰ΩúÁÇ∫Ë™çË≠â
      },
      
      // ÈÅäÊà≤Ë®≠ÂÆöÁÆ°ÁêÜÔºà‰ΩøÁî® LocalStorageÔºâ
      getGameSettings() {
        try {
          const settings = localStorage.getItem(this.KEYS.GAME_SETTINGS);
          return settings ? JSON.parse(settings) : this.getDefaultSettings();
        } catch (e) {
          console.error('ËÆÄÂèñÈÅäÊà≤Ë®≠ÂÆöÂ§±Êïó:', e);
          return this.getDefaultSettings();
        }
      },
      
      saveGameSettings(settings) {
        try {
          localStorage.setItem(this.KEYS.GAME_SETTINGS, JSON.stringify(settings));
        } catch (e) {
          console.error('ÂÑ≤Â≠òÈÅäÊà≤Ë®≠ÂÆöÂ§±Êïó:', e);
        }
      },
      
      getDefaultSettings() {
        return {
          volume: 1.0, // Èü≥Èáè (0.0 - 1.0)
          soundEnabled: true, // Èü≥ÊïàÈñãÈóú
          autoSave: true, // Ëá™ÂãïÂÑ≤Â≠ò
          theme: 'default', // ‰∏ªÈ°å
        };
      },
      
      // Ëá®ÊôÇÈÅäÊà≤ÈÄ≤Â∫¶ÁÆ°ÁêÜÔºà‰ΩøÁî® LocalStorageÔºâ
      getGameProgress() {
        try {
          const progress = localStorage.getItem(this.KEYS.GAME_PROGRESS);
          return progress ? JSON.parse(progress) : null;
        } catch (e) {
          console.error('ËÆÄÂèñÈÅäÊà≤ÈÄ≤Â∫¶Â§±Êïó:', e);
          return null;
        }
      },
      
      saveGameProgress(progress) {
        try {
          localStorage.setItem(this.KEYS.GAME_PROGRESS, JSON.stringify(progress));
        } catch (e) {
          console.error('ÂÑ≤Â≠òÈÅäÊà≤ÈÄ≤Â∫¶Â§±Êïó:', e);
        }
      },
      
      clearGameProgress() {
        try {
          localStorage.removeItem(this.KEYS.GAME_PROGRESS);
        } catch (e) {
          console.error('Ê∏ÖÈô§ÈÅäÊà≤ÈÄ≤Â∫¶Â§±Êïó:', e);
        }
      },
      
      // ÊúÄÂæå‰ΩøÁî®ÁöÑÁî®Êà∂ÂêçÔºàÂÉÖÁî®Êñº UI È°ØÁ§∫Ôºå‰∏ç‰ΩúÁÇ∫Ë™çË≠âÔºâ
      getLastUsername() {
        try {
          return localStorage.getItem(this.KEYS.LAST_USERNAME) || '';
        } catch (e) {
          return '';
        }
      },
      
      saveLastUsername(username) {
        try {
          if (username) {
            localStorage.setItem(this.KEYS.LAST_USERNAME, username);
          } else {
            localStorage.removeItem(this.KEYS.LAST_USERNAME);
          }
        } catch (e) {
          console.error('ÂÑ≤Â≠òÁî®Êà∂ÂêçÂ§±Êïó:', e);
        }
      },
      
      // Ê∏ÖÈô§ÊâÄÊúâÊú¨Âú∞Ë≥áÊñôÔºàÁôªÂá∫ÊôÇ‰ΩøÁî®Ôºâ
      clearAllLocalData() {
        try {
          this.clearGameProgress();
          // ‰øùÁïôÈÅäÊà≤Ë®≠ÂÆöÂíåÊúÄÂæåÁî®Êà∂ÂêçÔºåÊñπ‰æø‰∏ãÊ¨°‰ΩøÁî®
          // Â¶ÇÊûúÈúÄË¶ÅÂÆåÂÖ®Ê∏ÖÈô§ÔºåÂèØ‰ª•ÂèñÊ∂àË®ªËß£‰ª•‰∏ãÂÖ©Ë°åÔºö
          // localStorage.removeItem(this.KEYS.GAME_SETTINGS);
          // localStorage.removeItem(this.KEYS.LAST_USERNAME);
        } catch (e) {
          console.error('Ê∏ÖÈô§Êú¨Âú∞Ë≥áÊñôÂ§±Êïó:', e);
        }
      }
    };
    
    // Á´ãÂç≥Ê™¢Êü•ÁôªÂÖ•ÁãÄÊÖãÔºà‰ΩøÁî® Django Session CookieÔºå‰∏ç‰æùË≥¥ localStorageÔºâ
    (function() {
      // ‰ΩøÁî®Á´ãÂç≥Âü∑Ë°åÂáΩÊï∏ÔºåÂú® DOM Ëß£ÊûêÊôÇÂ∞±ÂòóË©¶Âü∑Ë°å
      async function checkLoginState() {
        // ÂÑ™ÂåñÔºöÂÖàÊ™¢Êü•ÊòØÂê¶Êúâ Session CookieÔºàÂø´ÈÄüÊ™¢Êü•Ôºâ
        // Â¶ÇÊûúÊúâ CookieÔºåÂòóË©¶ËºâÂÖ•Ë≥áÊñôÔºàÈùûÈòªÂ°ûÔºâ
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', () => {
            // DOM ËºâÂÖ•ÂæåÔºåÂòóË©¶ÈùúÈªòÊ™¢Êü•ÁôªÂÖ•ÁãÄÊÖã
            checkSessionAsync();
          });
        } else {
          checkSessionAsync();
        }
      }
      
      async function checkSessionAsync() {
        try {
          // ‰ΩøÁî®ÈùúÈªòÊ®°ÂºèÊ™¢Êü• sessionÔºà‰∏çÈ°ØÁ§∫ÈåØË™§Ôºâ
          const result = await fetch('/api/profile/', {
            method: 'GET',
            credentials: 'include', // ÂåÖÂê´ Cookie
            headers: {
              'Content-Type': 'application/json',
            }
          });
          
          if (result.ok) {
            // ÊúâÊúâÊïàÁöÑ sessionÔºåÈ°ØÁ§∫ÈÅäÊà≤ÂÖßÂÆπ
            applyLoginState();
          }
        } catch (e) {
          // ÈùúÈªòËôïÁêÜÈåØË™§Ôºå‰∏çÂΩ±ÈüøÈ†ÅÈù¢ËºâÂÖ•
        }
      }
      
      function applyLoginState() {
        const loginPanel = document.getElementById('loginPanel');
        const gameContent = document.getElementById('gameContent');
        const userInfo = document.getElementById('userInfo');
        
        if (loginPanel) loginPanel.style.display = 'none';
        if (gameContent) gameContent.style.display = 'block';
        if (userInfo) userInfo.style.display = 'flex';
      }
      
      // È†êÂ°´ÊúÄÂæå‰ΩøÁî®ÁöÑÁî®Êà∂ÂêçÔºàÊèêÂçáÁî®Êà∂È´îÈ©óÔºâ
      function prefillUsername() {
        const usernameInput = document.getElementById('usernameInput');
        if (usernameInput && !usernameInput.value) {
          const lastUsername = StorageManager.getLastUsername();
          if (lastUsername) {
            usernameInput.value = lastUsername;
          }
        }
      }
      
      // Á´ãÂç≥Âü∑Ë°åÊ™¢Êü•
      checkLoginState();
      
      // È†êÂ°´Áî®Êà∂ÂêçÔºàDOM ËºâÂÖ•ÂæåÔºâ
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', prefillUsername);
      } else {
        prefillUsername();
      }
    })();

    // ÈÅäÊà≤ÁãÄÊÖã
    let gameState = {
      isPlaying: false,
      timeRemaining: 5.0,
      clicks: 0,
      gameDuration: 5.0,
      timerInterval: null,
      autoClickerIntervals: [], // ÊîπÁÇ∫Êï∏ÁµÑÔºåÂ≠òÂÑ≤ÊØèÂÄãÂØµÁâ©ÁöÑÂÆöÊôÇÂô®
      userProfile: null,
      purchases: {},
      autoClickerRate: 0, // ÊØèÁßíÈªûÊìäÊ¨°Êï∏ÔºàÁî®ÊñºÈ°ØÁ§∫Ôºâ
      autoClickerInterval: 0, // ÈªûÊìäÈñìÈöîÊôÇÈñìÔºàÊØ´ÁßíÔºâ
      extraButtons: 0,
      badges: [null, null, null], // Áî®Êà∂ÈÅ∏ÊìáÁöÑ‰∏âÂÄãÊàêÂ∞±ÂæΩÁ´†
      unlockedAchievements: [], // Á∑©Â≠òÂ∑≤Ëß£ÈéñÁöÑÊàêÂ∞±ÂàóË°®ÔºåÈÅøÂÖçÈáçË§á API Ë™øÁî®
    };

    // ÁæéÂåñÁ¢∫Ë™çÂ∞çË©±Ê°ÜÂáΩÊï∏
    let confirmCallback = null;
    function showConfirmModal(message, title = 'Á¢∫Ë™ç') {
      return new Promise((resolve) => {
        confirmCallback = resolve;
        document.getElementById('confirmTitle').textContent = title;
        document.getElementById('confirmMessage').textContent = message;
        document.getElementById('confirmModal').classList.add('active');
      });
    }

    function closeConfirmModal(result) {
      document.getElementById('confirmModal').classList.remove('active');
      if (confirmCallback) {
        confirmCallback(result);
        confirmCallback = null;
      }
    }

    // ÁæéÂåñÊèêÁ§∫Â∞çË©±Ê°ÜÂáΩÊï∏
    let alertCallback = null;
    function showAlertModal(message, title = 'ÊèêÁ§∫', icon = '‚ÑπÔ∏è') {
      return new Promise((resolve) => {
        alertCallback = resolve;
        document.getElementById('alertTitle').textContent = title;
        document.getElementById('alertMessage').textContent = message;
        document.querySelector('#alertModal .alert-icon').textContent = icon;
        document.getElementById('alertModal').classList.add('active');
      });
    }

    function closeAlertModal() {
      document.getElementById('alertModal').classList.remove('active');
      if (alertCallback) {
        alertCallback();
        alertCallback = null;
      }
    }

    // ÊõøÊèõÂéüÁîü alert Âíå confirm ÁöÑÂåÖË£ùÂáΩÊï∏
    function customAlert(message, title = 'ÊèêÁ§∫', icon = '‚ÑπÔ∏è') {
      return showAlertModal(message, title, icon);
    }

    function customConfirm(message, title = 'Á¢∫Ë™ç') {
      return showConfirmModal(message, title);
    }

    // ËôïÁêÜÊ®°ÊÖãÊ°ÜËÉåÊôØÈªûÊìäÔºàÈªûÊìäËÉåÊôØÈóúÈñâÔºå‰ΩÜÈªûÊìäÂÖßÂÆπÂçÄÂüü‰∏çÈóúÈñâÔºâ
    function handleModalBackgroundClick(event, modalId) {
      // Â¶ÇÊûúÈªûÊìäÁöÑÊòØÊ®°ÊÖãÊ°ÜËÉåÊôØÔºà‰∏çÊòØÂÖßÂÆπÂçÄÂüüÔºâÔºåÂâáÈóúÈñâ
      if (event.target.id === modalId) {
        if (modalId === 'confirmModal') {
          closeConfirmModal(false);
        } else if (modalId === 'alertModal') {
          closeAlertModal();
        }
      }
    }

    // API Ë™øÁî®ÂáΩÊï∏
    async function apiCall(url, method = 'GET', data = null, silent = false, useToast = false) {
      const options = {
        method: method,
        headers: {
          'Content-Type': 'application/json',
        },
        credentials: 'include',
      };
      
      if (data) {
        options.body = JSON.stringify(data);
      }

      try {
        const response = await fetch(url, options);
        const result = await response.json();
        if (response.ok) {
          return result;
        } else {
          // Â∞áÂÆåÊï¥ÁöÑÈåØË™§Ë≥áË®äÂÇ≥ÈÅûÔºåÂåÖÊã¨È°çÂ§ñÁöÑË≥áÊñô
          const error = new Error(result.error || 'Ë´ãÊ±ÇÂ§±Êïó');
          error.result = result; // ‰øùÂ≠òÂÆåÊï¥ÁöÑÂõûÊáâÁµêÊûú
          throw error;
        }
      } catch (error) {
        console.error('API Error:', error);
        
        // Â¶ÇÊûúÊòØÈùúÈªòÊ®°ÂºèÔºå‰∏çÈ°ØÁ§∫‰ªª‰ΩïÊèêÁ§∫
        if (silent) {
          throw error;
        }
        
        // Â¶ÇÊûúÊòØ„ÄåÊú™ÁôªÈåÑ„ÄçÈåØË™§Ôºå‰∏çÈ°ØÁ§∫ÊèêÁ§∫ÔºàÈÄôÊòØÊ≠£Â∏∏ÊÉÖÊ≥ÅÔºâ
        if (error.message && error.message.includes('Êú™ÁôªÈåÑ')) {
          throw error;
        }
        
        // Â¶ÇÊûúÊòØ„ÄåÈáëÂπ£‰∏çË∂≥„ÄçÈåØË™§‰∏î‰ΩøÁî® ToastÔºåÈ°ØÁ§∫ÁæéÂåñÁöÑÈåØË™§ÊèêÁ§∫
        if (useToast && error.message && error.message.includes('ÈáëÂπ£‰∏çË∂≥') && error.result) {
          showErrorToast('ÈáëÂπ£‰∏çË∂≥', error.result);
          throw error;
        }
        
        // ËôïÁêÜ‰∏¶ÁôºË≥ºË≤∑ÈåØË™§Ôºà429 Too Many RequestsÔºâ
        if (error.result && error.result.error_type === 'concurrent_purchase') {
          const errorMessage = error.result.error || error.message || 'Ë≥ºË≤∑Ë´ãÊ±ÇÈÅéÊñºÈ†ªÁπÅÔºåË´ãÁ®çÂæåÂÜçË©¶';
          if (useToast) {
            showErrorToast('ÊèêÁ§∫', errorMessage);
          } else {
            await customAlert(errorMessage, 'ÊèêÁ§∫', '‚ö†Ô∏è');
          }
          throw error;
        }
        
        // ÂÖ∂‰ªñÈåØË™§Ôºö‰ΩøÁî® Toast Êàñ alert
        if (useToast) {
          let errorMessage = error.message;
          if (errorMessage.includes('timeout') || errorMessage.includes('connection') || errorMessage.includes('pooler.supabase.com')) {
            errorMessage = 'ÁÑ°Ê≥ïÈÄ£Êé•Âà∞Ë≥áÊñôÂ∫´‰º∫ÊúçÂô®ÔºåË´ãÁ®çÂæåÂÜçË©¶„ÄÇ';
          } else if (errorMessage.includes('500') || errorMessage.includes('Internal Server Error')) {
            errorMessage = '‰º∫ÊúçÂô®ÁôºÁîüÈåØË™§ÔºåË´ãÁ®çÂæåÂÜçË©¶„ÄÇ';
          } else if (errorMessage.includes('Ë´ãÊ±ÇÈÅéÊñºÈ†ªÁπÅ') || errorMessage.includes('concurrent')) {
            errorMessage = 'Ë≥ºË≤∑Ë´ãÊ±ÇÈÅéÊñºÈ†ªÁπÅÔºåË´ãÁ®çÂæåÂÜçË©¶„ÄÇ';
          }
          showErrorToast('ÈåØË™§', errorMessage);
        } else {
          // Ê™¢Ê∏¨Ë≥áÊñôÂ∫´ÈÄ£Êé•ÈåØË™§ÔºåÈ°ØÁ§∫Êõ¥ÂèãÂ•ΩÁöÑÈåØË™§Ë®äÊÅØ
          let errorMessage = error.message;
          if (errorMessage.includes('timeout') || errorMessage.includes('connection') || errorMessage.includes('pooler.supabase.com')) {
            errorMessage = 'ÁÑ°Ê≥ïÈÄ£Êé•Âà∞Ë≥áÊñôÂ∫´‰º∫ÊúçÂô®ÔºåË´ãÁ®çÂæåÂÜçË©¶„ÄÇ\n\nÂ¶ÇÊûúÂïèÈ°åÊåÅÁ∫åÂ≠òÂú®ÔºåÂèØËÉΩÊòØË≥áÊñôÂ∫´ÊúçÂãôÊö´ÊôÇÁÑ°Ê≥ï‰ΩøÁî®„ÄÇ';
          } else if (errorMessage.includes('500') || errorMessage.includes('Internal Server Error')) {
            errorMessage = '‰º∫ÊúçÂô®ÁôºÁîüÈåØË™§ÔºåË´ãÁ®çÂæåÂÜçË©¶„ÄÇ';
          } else if (errorMessage.includes('Ë´ãÊ±ÇÈÅéÊñºÈ†ªÁπÅ') || errorMessage.includes('concurrent')) {
            errorMessage = 'Ë≥ºË≤∑Ë´ãÊ±ÇÈÅéÊñºÈ†ªÁπÅÔºåË´ãÁ®çÂæåÂÜçË©¶„ÄÇ';
          }
          await customAlert('ÈåØË™§: ' + errorMessage, 'ÈåØË™§', '‚ö†Ô∏è');
        }
        throw error;
      }
    }

    // È°ØÁ§∫ËºâÂÖ•‰∏≠Ë¶ñÁ™ó
    function showLoadingModal(message = 'Ê≠£Âú®ËôïÁêÜ‰∏≠...', details = '') {
      document.getElementById('loadingText').textContent = message;
      const detailsEl = document.getElementById('loadingDetails');
      if (details) {
        detailsEl.textContent = details;
        detailsEl.style.display = 'block';
      } else {
        detailsEl.style.display = 'none';
      }
      document.getElementById('loadingModal').classList.add('active');
    }

    // Èö±ËóèËºâÂÖ•‰∏≠Ë¶ñÁ™ó
    function hideLoadingModal() {
      document.getElementById('loadingModal').classList.remove('active');
    }

    // ÁôªÈåÑÊàñË®ªÂÜä
    async function loginOrRegister() {
      const username = document.getElementById('usernameInput').value.trim();
      if (!username) {
        await customAlert('Ë´ãËº∏ÂÖ•Áî®Êà∂Âêç', 'ÊèêÁ§∫', '‚ö†Ô∏è');
        return;
      }

      // È°ØÁ§∫ËºâÂÖ•‰∏≠Ë¶ñÁ™ó
      showLoadingModal('Ê≠£Âú®ÁôªÂÖ•‰∏≠...', 'Ê≠£Âú®È©óË≠âÁî®Êà∂Âêç‰∏¶Âª∫Á´ãÈÄ£Á∑öÔºåË´ãÁ®çÂÄô');

      try {
        // Êõ¥Êñ∞ËºâÂÖ•Ë®äÊÅØ
        setTimeout(() => {
          if (document.getElementById('loadingModal').classList.contains('active')) {
            document.getElementById('loadingDetails').textContent = 'Ê≠£Âú®ÈÄ£Êé•Ë≥áÊñôÂ∫´‰º∫ÊúçÂô®...';
          }
        }, 1000);

        const result = await apiCall('/api/login/', 'POST', { username });
        
        // Êõ¥Êñ∞ËºâÂÖ•Ë®äÊÅØ
        if (document.getElementById('loadingModal').classList.contains('active')) {
          document.getElementById('loadingText').textContent = 'ÁôªÂÖ•ÊàêÂäüÔºÅ';
          document.getElementById('loadingDetails').textContent = 'Ê≠£Âú®ËºâÂÖ•ÈÅäÊà≤Ë≥áÊñô...';
        }

        if (result.success) {
          // ÁôªÂÖ•ÁãÄÊÖãÁî± Django Session Cookie ÁÆ°ÁêÜÔºàÊõ¥ÂÆâÂÖ®ÔºåHTTP OnlyÔºâ
          // ÂÉÖ‰øùÂ≠òÊúÄÂæå‰ΩøÁî®ÁöÑÁî®Êà∂ÂêçÂà∞ LocalStorageÔºàÁî®Êñº UI È°ØÁ§∫Ôºå‰∏ç‰ΩúÁÇ∫Ë™çË≠âÔºâ
          StorageManager.saveLastUsername(username);
          
          // Ê∏ÖÈô§‰πãÂâçÁöÑÊ≠∑Âè≤Ë®òÈåÑÈ°ØÁ§∫
          document.getElementById('historyContainer').innerHTML = '<p style="color: #666;">Êö´ÁÑ°Ë®òÈåÑ</p>';
          document.getElementById('detailedHistoryContainer').innerHTML = '<p style="color: #666; text-align: center; padding: 20px;">Êö´ÁÑ°Ë®òÈåÑ</p>';
          
          gameState.userProfile = result.profile;
          document.getElementById('loginPanel').style.display = 'none';
          document.getElementById('gameContent').style.display = 'block';
          document.getElementById('userInfo').style.display = 'flex';
          updateProfileDisplay();
          
          // Êõ¥Êñ∞ËºâÂÖ•Ë®äÊÅØ
          if (document.getElementById('loadingModal').classList.contains('active')) {
            document.getElementById('loadingDetails').textContent = 'Ê≠£Âú®ËºâÂÖ•ÂïÜÂ∫ó„ÄÅÊàêÂ∞±ÂíåÊ≠∑Âè≤Ë®òÈåÑ...';
          }
          
          // ÂÑ™ÂåñÔºöËºâÂÖ•ÂÆåÊï¥ÁöÑ profileÔºàÂåÖÂê´Ë≥ºË≤∑Ë®òÈåÑÂíåÂæΩÁ´†ÔºâÔºåloadProfile ÂÖßÈÉ®ÊúÉ‰∏¶Ë°åËºâÂÖ•ÂÖ∂‰ªñË≥áÊñô
          await loadProfile();
          
          // Ê™¢Êü•ÊòØÂê¶ÁÇ∫Ë∂ÖÁ¥öÂ∏≥Ëôü
          checkSuperAccount();
          
          // ÊâÄÊúâË≥áÊñôËºâÂÖ•ÂÆåÊàêÔºåÊõ¥Êñ∞ËºâÂÖ•Ë®äÊÅØ
          if (document.getElementById('loadingModal').classList.contains('active')) {
            document.getElementById('loadingText').textContent = 'ËºâÂÖ•ÂÆåÊàêÔºÅ';
            document.getElementById('loadingDetails').textContent = 'Ê≠°ËøéÂõû‰æÜÔºåÈñãÂßãÈÅäÊà≤ÂêßÔºÅ';
          }
          
          // Áü≠Êö´Âª∂ÈÅ≤ÂæåÈö±ËóèËºâÂÖ•Ë¶ñÁ™óÔºåËÆìÁî®Êà∂ÁúãÂà∞ÂÆåÊàêË®äÊÅØ
          setTimeout(() => {
            hideLoadingModal();
          }, 800);
        }
      } catch (error) {
        // Èö±ËóèËºâÂÖ•Ë¶ñÁ™óÔºàÈåØË™§Â∑≤Âú® apiCall ‰∏≠ËôïÁêÜ‰∏¶È°ØÁ§∫ alertÔºâ
        hideLoadingModal();
      }
    }

    // Ê™¢Êü•ÊòØÂê¶ÁÇ∫Ë∂ÖÁ¥öÂ∏≥Ëôü
    function checkSuperAccount() {
      const superAccountControls = document.getElementById('superAccountControls');
      if (gameState.userProfile && gameState.userProfile.username === 'super_test') {
        superAccountControls.style.display = 'block';
        // Ë®≠ÁΩÆÁï∂ÂâçÈÅäÊà≤ÊôÇÈï∑ÔºàË∂ÖÁ¥öÂ∏≥Ëôü‰ΩøÁî®Áç®Á´ãË®≠ÁΩÆÔºå‰∏çÂèóÊôÇÈñìÂª∂Èï∑Ë≥ºË≤∑ÂΩ±ÈüøÔºâ
        const timeInput = document.getElementById('superTimeInput');
        const timeDisplay = document.getElementById('superTimeDisplay');
        if (timeInput && timeDisplay) {
          // Ë∂ÖÁ¥öÂ∏≥ËôüÊéßÂà∂Èù¢ÊùøÂßãÁµÇ‰ΩøÁî®È†êË®≠ÂÄº 5 ÁßíÔºå‰∏çÂèóÊôÇÈñìÂª∂Èï∑Ë≥ºË≤∑ÂΩ±Èüø
          // Â¶ÇÊûúÊªëÊ°øÂ∑≤Á∂ìÊúâÊúâÊïàÂÄºÔºà5-30ÔºâÔºå‰øùÊåÅÂÆÉÔºõÂê¶ÂâáË®≠ÁΩÆÁÇ∫È†êË®≠ÂÄº 5
          let currentTime = 5;
          const existingValue = parseInt(timeInput.value);
          if (existingValue >= 5 && existingValue <= 30) {
            currentTime = existingValue;
          }
          timeInput.value = currentTime;
          timeDisplay.textContent = currentTime + ' Áßí';
          
          // ÁßªÈô§ËàäÁöÑ‰∫ã‰ª∂Áõ£ËÅΩÂô®ÔºàÂ¶ÇÊûúÂ≠òÂú®ÔºâÔºåÈÅøÂÖçÈáçË§áÁ∂ÅÂÆö
          const newTimeInput = timeInput.cloneNode(true);
          timeInput.parentNode.replaceChild(newTimeInput, timeInput);
          
          // Ê∑ªÂä†ÊªëÊ°ø‰∫ã‰ª∂Áõ£ËÅΩ
          newTimeInput.addEventListener('input', function() {
            const newTime = parseInt(this.value);
            timeDisplay.textContent = newTime + ' Áßí';
            if (!gameState.isPlaying) {
              updateSuperTime(newTime);
            }
          });
        }
        
        // ÂïÜÂ∫óÁ≠âÁ¥öÂõûÊ∫ØÂäüËÉΩÂ∑≤Á∞°ÂåñÔºåÁÑ°ÈúÄÂàùÂßãÂåñ
      } else {
        superAccountControls.style.display = 'none';
      }
    }

    // ÊâπÈáèÂõûÊ∫ØÊâÄÊúâÂïÜÂ∫óÁâ©ÂìÅÂà∞ÂàùÂßãÁãÄÊÖã
    async function rollbackAllShopItems() {
      const rollbackAllButton = document.getElementById('rollbackAllButton');
      
      const confirmed = await customConfirm('Á¢∫ÂÆöË¶ÅÂ∞áÊâÄÊúâÂïÜÂ∫óÁâ©ÂìÅÂõûÊ∫ØÂà∞ÂàùÂßãÁãÄÊÖãÔºàÁ≠âÁ¥ö 0ÔºâÂóéÔºü', 'Á¢∫Ë™çÂõûÊ∫Ø');
      if (!confirmed) {
        return;
      }
      
      // Á¶ÅÁî®ÊåâÈàïÈò≤Ê≠¢ÈáçË§áÈªûÊìä
      rollbackAllButton.disabled = true;
      rollbackAllButton.textContent = 'ÂõûÊ∫Ø‰∏≠...';
      
      try {
        const result = await apiCall('/api/rollback-all-shop-items/', 'POST');
        
        if (result.success) {
          // È°ØÁ§∫ÊàêÂäüË®äÊÅØ
          if (result.rolled_back_count > 0) {
            await customAlert(result.message, 'ÊèêÁ§∫', '‚úÖ');
          } else {
            await customAlert('Ê≤íÊúâÈúÄË¶ÅÂõûÊ∫ØÁöÑÂïÜÂ∫óÁâ©ÂìÅ', 'ÊèêÁ§∫', '‚ÑπÔ∏è');
          }
          
          // ÈáçÊñ∞Âä†ËºâË≥áÊñô
          await loadProfile();
          await loadShop();
        }
      } catch (error) {
        // ÈåØË™§Â∑≤Âú® apiCall ‰∏≠ËôïÁêÜ
      } finally {
        // ÊÅ¢Âæ©ÊåâÈàïÁãÄÊÖã
        rollbackAllButton.disabled = false;
        rollbackAllButton.textContent = 'üîÑ ÂÖ®ÈÉ®ÂõûÊ∫Ø';
      }
    }

    // Êõ¥Êñ∞Ë∂ÖÁ¥öÂ∏≥ËôüÁöÑÈÅäÊà≤ÊôÇÈï∑
    function updateSuperTime(newTime) {
      if (gameState.isPlaying) {
        return; // ÈÅäÊà≤ÈÄ≤Ë°å‰∏≠‰∏çÂÖÅË®±‰øÆÊîπ
      }
      
      if (newTime === undefined) {
        const timeInput = document.getElementById('superTimeInput');
        if (timeInput) {
          newTime = parseInt(timeInput.value);
        } else {
          return;
        }
      }
      
      if (isNaN(newTime) || newTime < 1 || newTime > 30) {
        return;
      }
      
      gameState.gameDuration = newTime;
      gameState.timeRemaining = newTime;
      document.getElementById('timerDisplay').textContent = newTime + ' Áßí';
    }

    // ÁôªÂá∫Áî®Êà∂
    async function logoutUser() {
      const confirmed = await customConfirm('Á¢∫ÂÆöË¶ÅÁôªÂá∫ÂóéÔºü', 'Á¢∫Ë™çÁôªÂá∫');
      if (!confirmed) {
        return;
      }

      try {
        // ÂÅúÊ≠¢ÊâÄÊúâÈÅäÊà≤Ë®àÊôÇÂô®
        if (gameState.timerInterval) {
          clearInterval(gameState.timerInterval);
        }
      // Ê∏ÖÈô§ÊâÄÊúâÂØµÁâ©Â§•‰º¥ËÉΩÂäõÂÆöÊôÇÂô®
      gameState.autoClickerIntervals.forEach(interval => clearInterval(interval));
      gameState.autoClickerIntervals = [];

        // Ë™øÁî®ÁôªÂá∫ API
        await apiCall('/api/logout/', 'POST');
        
        // ÁôªÂÖ•ÁãÄÊÖãÁî± Django Session Cookie ÁÆ°ÁêÜÔºåÁôªÂá∫ÊôÇÊúÉËá™ÂãïÊ∏ÖÈô§
        // Ê∏ÖÈô§Êú¨Âú∞ÈÅäÊà≤ÈÄ≤Â∫¶Ôºà‰øùÁïôË®≠ÂÆöÂíåÊúÄÂæåÁî®Êà∂ÂêçÔºâ
        StorageManager.clearAllLocalData();
        
        // ÈáçÁΩÆÈÅäÊà≤ÁãÄÊÖã
        gameState = {
          isPlaying: false,
          timeRemaining: 5.0,
          clicks: 0,
          gameDuration: 5.0,
          timerInterval: null,
          autoClickerIntervals: [],
          userProfile: null,
          purchases: {},
          autoClickerRate: 0,
          autoClickerInterval: 0,
          extraButtons: 0,
          badges: [null, null, null],
        };

        // È°ØÁ§∫ÁôªÂÖ•Èù¢ÊùøÔºåÈö±ËóèÈÅäÊà≤ÂÖßÂÆπ
        document.getElementById('loginPanel').style.display = 'block';
        document.getElementById('gameContent').style.display = 'none';
        document.getElementById('userInfo').style.display = 'none';
        document.getElementById('usernameInput').value = '';
        
        // ÈóúÈñâÊâÄÊúâÊ®°ÊÖãÊ°Ü
        document.getElementById('shopModal').classList.remove('active');
        document.getElementById('achievementsModal').classList.remove('active');
        document.getElementById('accountModal').classList.remove('active');
        document.getElementById('historyModal').classList.remove('active');
        document.getElementById('achievementNotification').classList.remove('active');
        
        // Ê∏ÖÈô§Ê≠∑Âè≤Ë®òÈåÑÈ°ØÁ§∫
        document.getElementById('historyContainer').innerHTML = '<p style="color: #666;">Êö´ÁÑ°Ë®òÈåÑ</p>';
        document.getElementById('detailedHistoryContainer').innerHTML = '<p style="color: #666; text-align: center; padding: 20px;">Êö´ÁÑ°Ë®òÈåÑ</p>';
      } catch (error) {
        // Âç≥‰Ωø API Ë™øÁî®Â§±ÊïóÔºå‰πüÂü∑Ë°åÁôªÂá∫Êìç‰Ωú
        gameState = {
          isPlaying: false,
          timeRemaining: 5.0,
          clicks: 0,
          gameDuration: 5.0,
          timerInterval: null,
          autoClickerIntervals: [],
          userProfile: null,
          purchases: {},
          autoClickerRate: 0,
          extraButtons: 0,
        };
        document.getElementById('loginPanel').style.display = 'block';
        document.getElementById('gameContent').style.display = 'none';
        document.getElementById('userInfo').style.display = 'none';
        document.getElementById('usernameInput').value = '';
        // ÈóúÈñâÊâÄÊúâÊ®°ÊÖãÊ°Ü
        document.getElementById('shopModal').classList.remove('active');
        document.getElementById('achievementsModal').classList.remove('active');
        document.getElementById('accountModal').classList.remove('active');
        document.getElementById('historyModal').classList.remove('active');
        document.getElementById('achievementNotification').classList.remove('active');
        
        // Ê∏ÖÈô§Ê≠∑Âè≤Ë®òÈåÑÈ°ØÁ§∫
        document.getElementById('historyContainer').innerHTML = '<p style="color: #666;">Êö´ÁÑ°Ë®òÈåÑ</p>';
        document.getElementById('detailedHistoryContainer').innerHTML = '<p style="color: #666; text-align: center; padding: 20px;">Êö´ÁÑ°Ë®òÈåÑ</p>';
      }
    }

    // Êõ¥Êñ∞Ë≥áÊñôÈ°ØÁ§∫
    function updateProfileDisplay() {
      if (!gameState.userProfile) return;
      // Êõ¥Êñ∞Â∏≥ËôüÂêçÁ®±ÔºàÂä†‰∏ä ID: ÂâçÁ∂¥Ôºâ
      if (gameState.userProfile.username) {
        document.getElementById('usernameDisplay').textContent = 'ID: ' + gameState.userProfile.username;
      }
      document.getElementById('coinsDisplay').textContent = gameState.userProfile.coins;
      document.getElementById('totalClicksDisplay').textContent = gameState.userProfile.total_clicks;
      document.getElementById('bestClicksDisplay').textContent = gameState.userProfile.best_clicks_per_round;
      document.getElementById('gamesPlayedDisplay').textContent = gameState.userProfile.total_games_played;
      
      // Êõ¥Êñ∞ÂæΩÁ´†È°ØÁ§∫
      updateBadgesDisplay();
    }

    // Êõ¥Êñ∞ÂæΩÁ´†È°ØÁ§∫
    function updateBadgesDisplay() {
      const badges = gameState.badges || [null, null, null];
      for (let i = 0; i < 3; i++) {
        const slot = document.getElementById(`badgeSlot${i + 1}`);
        const icon = document.getElementById(`badgeIcon${i + 1}`);
        if (badges[i]) {
          icon.textContent = badges[i].icon;
          slot.classList.add('has-badge');
          slot.title = badges[i].name;
        } else {
          icon.textContent = '-';
          slot.classList.remove('has-badge');
          slot.title = 'ÈªûÊìäÈÅ∏ÊìáÂæΩÁ´†';
        }
      }
    }

    // Âä†ËºâÁé©ÂÆ∂Ë≥áÊñô
    let isReloadingProfile = false; // Èò≤Ê≠¢ÁÑ°ÈôêÈÅûËø¥
    async function loadProfile(skipAutoRelogin = false) {
      // Â¶ÇÊûúÊ≠£Âú®ÈáçÊñ∞ËºâÂÖ•ÔºåÈÅøÂÖçÈáçË§áÂü∑Ë°å
      if (isReloadingProfile) return;
      
      try {
        // ‰ΩøÁî®ÈùúÈªòÊ®°ÂºèÔºåÈÅøÂÖçÊú™ÁôªÈåÑÊôÇÈ°ØÁ§∫ÈåØË™§Ë®äÊÅØ
        const result = await apiCall('/api/profile/', 'GET', null, true);
        isReloadingProfile = false; // ÈáçÁΩÆÊ®ôË®ò
        
        gameState.userProfile = result.profile;
        gameState.purchases = result.purchases || {};
        gameState.badges = result.badges || [null, null, null];
        // Á∑©Â≠òÂ∑≤Ëß£ÈéñÁöÑÊàêÂ∞±ÂàóË°®ÔºåÂÑ™ÂåñÂæΩÁ´†ÈÅ∏ÊìáÈüøÊáâÈÄüÂ∫¶
        gameState.unlockedAchievements = result.achievements || [];
        updateProfileDisplay();
        updateGameUpgrades();
        // Â¶ÇÊûúÊàêÂäüÂä†ËºâË≥áÊñôÔºåË°®Á§∫Â∑≤ÁôªÈåÑÔºåÈ°ØÁ§∫ÈÅäÊà≤ÂÖßÂÆπ
        document.getElementById('loginPanel').style.display = 'none';
        document.getElementById('gameContent').style.display = 'block';
        document.getElementById('userInfo').style.display = 'flex';
        
        // ‰øùÂ≠òÊúÄÂæå‰ΩøÁî®ÁöÑÁî®Êà∂ÂêçÂà∞ LocalStorageÔºàÁî®Êñº UI È°ØÁ§∫Ôºå‰∏ç‰ΩúÁÇ∫Ë™çË≠âÔºâ
        if (result.profile && result.profile.username) {
          StorageManager.saveLastUsername(result.profile.username);
        }
        
        // ÂÑ™ÂåñÔºö‰∏¶Ë°åËºâÂÖ•ÊâÄÊúâË≥áÊñôÔºåÊ∏õÂ∞ëÁ≠âÂæÖÊôÇÈñì
        // Á≠âÂæÖÊâÄÊúâË≥áÊñôËºâÂÖ•ÂÆåÊàêÔºåÁ¢∫‰øùËºâÂÖ•Ë¶ñÁ™óÂú®Ë≥áÊñôÂÆåÂÖ®ËºâÂÖ•ÂæåÊâçÈóúÈñâ
        await Promise.all([
          loadShop(),
          loadAchievements(),
          loadHistory()
        ]).catch(error => {
          console.error('ËºâÂÖ•Ë≥áÊñôÊôÇÁôºÁîüÈåØË™§:', error);
        });
        // Ê™¢Êü•ÊòØÂê¶ÁÇ∫Ë∂ÖÁ¥öÂ∏≥Ëôü
        checkSuperAccount();
      } catch (error) {
        isReloadingProfile = false; // ÈáçÁΩÆÊ®ôË®ò
        
        // Â¶ÇÊûúÊú™ÁôªÈåÑ‰∏îÊú™Ë∑≥ÈÅéËá™ÂãïÈáçÊñ∞ÁôªÂÖ•ÔºåÊ™¢Êü•ÊòØÂê¶ÊúâÊúÄÂæå‰ΩøÁî®ÁöÑÁî®Êà∂Âêç
        // Â¶ÇÊûúÊúâÔºåÂèØ‰ª•ÂòóË©¶Ëá™ÂãïÈáçÊñ∞ÁôªÂÖ•ÔºàÂèØËÉΩÊòØ session ÈÅéÊúü‰ΩÜÁî®Êà∂‰ªçÊÉ≥‰øùÊåÅÁôªÂÖ•Ôºâ
        if (!skipAutoRelogin) {
          const lastUsername = StorageManager.getLastUsername();
          
          if (lastUsername) {
            // ÂòóË©¶Ëá™ÂãïÈáçÊñ∞ÁôªÂÖ•
            isReloadingProfile = true; // Ë®≠ÁΩÆÊ®ôË®òÔºåÈò≤Ê≠¢ÈÅûËø¥
            // È°ØÁ§∫ËºâÂÖ•‰∏≠Ë¶ñÁ™ó
            showLoadingModal('Ê≠£Âú®ÈáçÊñ∞ÁôªÂÖ•‰∏≠...', 'ÂÅµÊ∏¨Âà∞Â∑≤‰øùÂ≠òÁöÑÁôªÂÖ•ÁãÄÊÖãÔºåÊ≠£Âú®ÈáçÊñ∞ÈÄ£Á∑ö...');
            try {
              const result = await apiCall('/api/login/', 'POST', { username: lastUsername }, true);
              if (result.success) {
                // Êõ¥Êñ∞ËºâÂÖ•Ë®äÊÅØ
                if (document.getElementById('loadingModal').classList.contains('active')) {
                  document.getElementById('loadingText').textContent = 'ÈáçÊñ∞ÁôªÂÖ•ÊàêÂäüÔºÅ';
                  document.getElementById('loadingDetails').textContent = 'Ê≠£Âú®ËºâÂÖ•ÂïÜÂ∫ó„ÄÅÊàêÂ∞±ÂíåÊ≠∑Âè≤Ë®òÈåÑ...';
                }
                // ÈáçÊñ∞ÁôªÂÖ•ÊàêÂäüÔºåÈáçÊñ∞ËºâÂÖ•Ë≥áÊñôÔºàË∑≥ÈÅéËá™ÂãïÈáçÊñ∞ÁôªÂÖ•ÔºåÈÅøÂÖçÁÑ°ÈôêÈÅûËø¥Ôºâ
                await loadProfile(true);
                
                // ÊâÄÊúâË≥áÊñôËºâÂÖ•ÂÆåÊàêÔºåÊõ¥Êñ∞ËºâÂÖ•Ë®äÊÅØ
                if (document.getElementById('loadingModal').classList.contains('active')) {
                  document.getElementById('loadingText').textContent = 'ËºâÂÖ•ÂÆåÊàêÔºÅ';
                  document.getElementById('loadingDetails').textContent = 'Ê≠°ËøéÂõû‰æÜÔºåÈñãÂßãÈÅäÊà≤ÂêßÔºÅ';
                }
                
                // Èö±ËóèËºâÂÖ•Ë¶ñÁ™ó
                setTimeout(() => {
                  hideLoadingModal();
                }, 800);
                return;
              }
            } catch (loginError) {
              // Ëá™ÂãïÁôªÂÖ•Â§±ÊïóÔºåÊ∏ÖÈô§ÊúÄÂæåÁî®Êà∂Âêç‰∏¶È°ØÁ§∫ÁôªÂÖ•Èù¢Êùø
              StorageManager.saveLastUsername(''); // Ê∏ÖÈô§ÊúÄÂæåÁî®Êà∂Âêç
              hideLoadingModal();
            }
          }
        }
        // Â¶ÇÊûúÊú™ÁôªÈåÑÔºå‰øùÊåÅÁôªÈåÑÈù¢ÊùøÈ°ØÁ§∫
        // ÈÄôÊòØÊ≠£Â∏∏ÊÉÖÊ≥ÅÔºå‰∏çÈúÄË¶ÅËôïÁêÜÔºå‰πü‰∏çÈ°ØÁ§∫ÈåØË™§Ë®äÊÅØ
      }
    }

    // Êõ¥Êñ∞ÈÅäÊà≤ÂçáÁ¥ö
    function updateGameUpgrades() {
      // Êõ¥Êñ∞ÈÅäÊà≤ÊôÇÈï∑
      if (gameState.purchases.time_extension) {
        gameState.gameDuration = 5.0 + gameState.purchases.time_extension.effect_value;
      } else {
        gameState.gameDuration = 5.0;
      }

      // Êõ¥Êñ∞È°çÂ§ñÊåâÈàï
      // ÂÖàÈáçÁΩÆÁÇ∫0ÔºåÁÑ∂ÂæåÊ†πÊìöË≥ºË≤∑Ë®òÈåÑË®≠ÁΩÆ
      // ÊåâÈàïÊï∏ÈáèÊáâË©≤Á≠âÊñºÁ≠âÁ¥öÔºàÁ≠âÁ¥ö1 = 1ÂÄãÊåâÈàïÔºåÁ≠âÁ¥ö2 = 2ÂÄãÊåâÈàïÔºå‰ª•Ê≠§È°ûÊé®Ôºâ
      gameState.extraButtons = 0;
      if (gameState.purchases.extra_button && gameState.purchases.extra_button.level > 0) {
        gameState.extraButtons = gameState.purchases.extra_button.level;
      }
      updateClickButtons();

      // Êõ¥Êñ∞ÂØµÁâ©Â§•‰º¥ËÉΩÂäõ
      // Ê†πÊìöÁ≠âÁ¥öË®àÁÆóÈªûÊìäÈ†ªÁéáÔºö
      // Á≠âÁ¥ö1Ôºö3ÁßíÈªûÊìä‰∏ÄÊ¨°
      // Á≠âÁ¥ö2Ôºö2ÁßíÈªûÊìä‰∏ÄÊ¨°
      // Á≠âÁ¥ö3Ôºö1ÁßíÈªûÊìä‰∏ÄÊ¨°
      // Á≠âÁ¥ö4+Ôºö1ÁßíÈªûÊìä(Á≠âÁ¥ö-2)Ê¨°
      if (gameState.purchases.auto_clicker) {
        const level = gameState.purchases.auto_clicker.level;
        if (level <= 3) {
          // Á≠âÁ¥ö1-3Ôºö‰ΩøÁî®ÈñìÈöîÊôÇÈñìÔºà3Áßí„ÄÅ2Áßí„ÄÅ1ÁßíÔºâ
          gameState.autoClickerRate = 1 / (4 - level); // ËΩâÊèõÁÇ∫ÊØèÁßíÈªûÊìäÊ¨°Êï∏ÔºåÁî®ÊñºÈ°ØÁ§∫
          gameState.autoClickerInterval = (4 - level) * 1000; // ÈñìÈöîÊôÇÈñìÔºàÊØ´ÁßíÔºâ
        } else {
          // Á≠âÁ¥ö4+ÔºöÊØèÁßíÈªûÊìä(Á≠âÁ¥ö-2)Ê¨°
          gameState.autoClickerRate = level - 2; // ÊØèÁßíÈªûÊìäÊ¨°Êï∏
          gameState.autoClickerInterval = 1000 / (level - 2); // ÈñìÈöîÊôÇÈñìÔºàÊØ´ÁßíÔºâ
        }
      } else {
        gameState.autoClickerRate = 0;
        gameState.autoClickerInterval = 0;
      }
      
      // Êõ¥Êñ∞ÂØµÁâ©Â§•‰º¥ËÉΩÂäõÈ°ØÁ§∫ÔºàÈúÄË¶ÅÂêåÊôÇÊúâÂØµÁâ©Â§•‰º¥ËÉΩÂäõÂíåÂØµÁâ©Â§•‰º¥Ôºâ
      const infoDiv = document.getElementById('autoClickerInfo');
      if (gameState.autoClickerRate > 0 && gameState.extraButtons > 0) {
        infoDiv.style.display = 'block';
        // Ë®àÁÆóÂØ¶ÈöõÁ∏ΩÈªûÊìäÈ†ªÁéáÔºöÊØèÂÄãÊåâÈàïÁöÑÈ†ªÁéá √ó ÊåâÈàïÊï∏Èáè
        const totalClickRate = gameState.autoClickerRate * gameState.extraButtons;
        // Êõ¥Êñ∞È°ØÁ§∫ÔºöÊØèÂÄãÈªûÊìäÂô®È†ªÁéá„ÄÅÊï∏Èáè„ÄÅÁ∏ΩÈ†ªÁéá
        document.getElementById('autoClickerRatePerButton').textContent = gameState.autoClickerRate.toFixed(2);
        document.getElementById('autoClickerCount').textContent = gameState.extraButtons;
        document.getElementById('autoClickerTotalRate').textContent = totalClickRate.toFixed(2);
      } else {
        infoDiv.style.display = 'none';
      }

      // Êõ¥Êñ∞Ë∂ÖÁ¥öÂ∏≥ËôüÊéßÂà∂Èù¢ÊùøÁöÑÊôÇÈñìÈ°ØÁ§∫
      // Ê≥®ÊÑèÔºöË∂ÖÁ¥öÂ∏≥ËôüÁöÑÊôÇÈñìË®≠ÁΩÆ‰∏çÊáâË¢´ÊôÇÈñìÂª∂Èï∑Ë≥ºË≤∑ÂΩ±Èüø
      // Âè™ÊúâÂú®ÊªëÊ°øÊ≤íÊúâË¢´ÊâãÂãïË®≠ÁΩÆÊôÇÊâçÊõ¥Êñ∞
      if (gameState.userProfile && gameState.userProfile.username === 'super_test') {
        const superTimeInput = document.getElementById('superTimeInput');
        const superTimeDisplay = document.getElementById('superTimeDisplay');
        if (superTimeInput && superTimeDisplay) {
          // ‰øùÊåÅÁï∂ÂâçÊªëÊ°øÁöÑÂÄºÔºå‰∏çÊ†πÊìö gameDuration Êõ¥Êñ∞
          // ÈÄôÊ®£ÂèØ‰ª•ÈÅøÂÖçÊôÇÈñìÂª∂Èï∑Ë≥ºË≤∑ÂΩ±ÈüøË∂ÖÁ¥öÂ∏≥ËôüÁöÑÊâãÂãïË®≠ÁΩÆ
          const currentTime = parseInt(superTimeInput.value) || 5;
          if (currentTime >= 5 && currentTime <= 30) {
            superTimeDisplay.textContent = currentTime + ' Áßí';
          } else {
            // Â¶ÇÊûúÂÄº‰∏çÂú®ÂêàÁêÜÁØÑÂúçÂÖßÔºåÈáçÁΩÆÁÇ∫ 5
            superTimeInput.value = 5;
            superTimeDisplay.textContent = '5 Áßí';
          }
        }
      }
    }

    // Êõ¥Êñ∞ÈªûÊìäÊåâÈàï
    function updateClickButtons() {
      const container = document.getElementById('clickButtonsContainer');
      container.innerHTML = '';
      
      // ÂãïÁâ©emojiÂàóË°®ÔºàÁî±Â∞èÂà∞Â§ßÔºâ
      const animalEmojis = ['üê≠', 'üê±', 'ü¶Å', 'üêò', 'ü¶è'];
      
      // ‰∏ªÊåâÈàïÂÆπÂô®ÔºàÁç®Á´ã‰∏ÄË°åÔºâ
      const mainButtonWrapper = document.createElement('div');
      mainButtonWrapper.className = 'main-button-wrapper';
      
      // ‰∏ªÊåâÈàïÔºàÊâãÂãïÈªûÊìäÔºå‰øùÊåÅÊªëÈº†ÂúñÊ®ôÔºâ
      const mainButton = document.createElement('button');
      mainButton.className = 'click-button';
      mainButton.id = 'mainClickButton';
      // Â¶ÇÊûúÈÅäÊà≤Êú™ÈñãÂßãÔºåÁ¶ÅÁî®ÊåâÈàïÔºàÈ°ØÁ§∫ÁÇ∫ÁÅ∞Ëâ≤Ôºâ
      if (!gameState.isPlaying) {
        mainButton.disabled = true;
      }
      const mainButtonText = document.createElement('span');
      mainButtonText.className = 'button-text';
      mainButtonText.textContent = 'ÈªûÊìäÔºÅ';
      mainButton.appendChild(mainButtonText);
      
      // Ë°åÂãïË£ùÁΩÆÔºöÂè™‰ΩøÁî® touchstartÔºàÊåâ‰∏ãÊôÇË®àÁÆóÔºâÔºå‰∏ç‰ΩøÁî® touchend
      // ‰ΩøÁî®Ê®ôË®ò‰æÜÈò≤Ê≠¢ touchstart Ëß∏ÁôºÂæåÁÄèË¶ΩÂô®Ëá™ÂãïËß∏ÁôºÁöÑ click ‰∫ã‰ª∂ÈáçË§áË®àÁÆó
      let touchHandledTimeout = null;
      
      mainButton.addEventListener('touchstart', function(e) {
        if (gameState.isPlaying) {
          // Ê∏ÖÈô§‰πãÂâçÁöÑÊ®ôË®òÊ∏ÖÈô§ÂÆöÊôÇÂô®ÔºàÂ¶ÇÊûúÂ≠òÂú®Ôºâ
          if (touchHandledTimeout) {
            clearTimeout(touchHandledTimeout);
          }
          
          // Ê®ôË®òÂ∑≤Áî± touchstart ËôïÁêÜÔºåÈÅøÂÖçÂæåÁ∫åÁöÑ click ‰∫ã‰ª∂ÈáçË§áË®àÁÆó
          mainButton.dataset.touchHandled = 'true';
          
          // Á´ãÂç≥Ëß∏ÁôºÈªûÊìäÔºàÂè™Ë®àÁÆóÊåâ‰∏ãÊôÇÔºâ
          handleClick(e);
          
          // 300ms ÂæåÊ∏ÖÈô§Ê®ôË®òÔºàÁÄèË¶ΩÂô®ÈÄöÂ∏∏Âú® touchend ÂæåÁ¥Ñ 300ms Ëß∏Áôº clickÔºâ
          touchHandledTimeout = setTimeout(() => {
            delete mainButton.dataset.touchHandled;
            touchHandledTimeout = null;
          }, 300);
        }
      }, { passive: true });
      
      // Ê°åÈù¢Áâà‰ΩøÁî® onclickÔºåË°åÂãïË£ùÁΩÆÁöÑ click ‰∫ã‰ª∂ÊúÉË¢´Ê®ôË®òÈòªÊ≠¢
      mainButton.onclick = function(e) {
        // Â¶ÇÊûúÊòØËß∏Êë∏Ë®≠ÂÇôÔºåtouchstart Â∑≤Á∂ìËôïÁêÜ‰∫ÜÔºåÈÄôË£°‰∏çËôïÁêÜÔºàÈÅøÂÖçÈáçË§áÔºâ
        if (!this.dataset.touchHandled) {
          handleClick(e);
        }
      };
      
      mainButtonWrapper.appendChild(mainButton);
      container.appendChild(mainButtonWrapper);

      // Â¶ÇÊûúÊúâÂØµÁâ©Â§•‰º¥ÔºåÂâµÂª∫ÂØµÁâ©Â§•‰º¥ÂÆπÂô®
      if (gameState.extraButtons > 0) {
        const petsWrapper = document.createElement('div');
        petsWrapper.className = 'companion-pets-wrapper';
        petsWrapper.id = 'companionPetsWrapper';
        
        // ÂØµÁâ©ÂêçÁ®±ÂàóË°®ÔºàÂ∞çÊáâÂãïÁâ©Ôºâ
        const petNames = ['ÈªûÈªûÈº†', 'Êö¥ÊìäË≤ì', 'ÈªÉÈáëÁçÖ', 'Á©©Á©©Ë±°', 'ÈãºÈêµÁäÄ'];
        const animalEmojis = ['üê≠', 'üê±', 'ü¶Å', 'üêò', 'ü¶è'];
        const animalTypes = ['mouse', 'cat', 'lion', 'elephant', 'rhino'];
        
        for (let i = 0; i < gameState.extraButtons; i++) {
          // ÂâµÂª∫ÂØµÁâ©Âç°Áâá
          const petCard = document.createElement('div');
          petCard.className = 'companion-pet';
          petCard.id = `companionPet${i + 1}`;
          
          // Ë®≠ÁΩÆÂãïÁâ©È°ûÂûãÔºàÁî®Êñº8bitÂãïÁï´Ôºâ
          const animalType = animalTypes[i] || 'robot';
          petCard.setAttribute('data-animal', animalType);
          
          // ÂâµÂª∫ÂØµÁâ©ÂãïÁï´ÂÖÉÁ¥†
          const petAnimation = document.createElement('div');
          petAnimation.className = 'companion-pet-animation';
          petAnimation.textContent = animalEmojis[i] || 'ü§ñ';
          petCard.appendChild(petAnimation);
          
          // ÂâµÂª∫ÂØµÁâ©ÂêçÁ®±Ê®ôÁ±§
          const petName = document.createElement('div');
          petName.className = 'companion-pet-name';
          petName.textContent = petNames[i] || 'Ê©üÂô®‰∫∫';
          petCard.appendChild(petName);
          
          // ÂâµÂª∫ÂØµÁâ©Á≠âÁ¥öÊ®ôÁ±§ÔºàÈ°ØÁ§∫ÂØµÁâ©Â§•‰º¥ËÉΩÂäõÁ≠âÁ¥öÔºâ
          const petLevel = document.createElement('div');
          petLevel.className = 'companion-pet-level';
          // Ê†πÊìöÂØµÁâ©Â§•‰º¥ËÉΩÂäõÁ≠âÁ¥öÈ°ØÁ§∫ÔºàÂ¶ÇÊûúÊúâÁöÑË©±Ôºâ
          const autoClickerLevel = gameState.purchases.auto_clicker ? gameState.purchases.auto_clicker.level : 1;
          petLevel.textContent = `Lv.${autoClickerLevel}`;
          petCard.appendChild(petLevel);
          
          petsWrapper.appendChild(petCard);
        }
        
        container.appendChild(petsWrapper);
      }
    }

    // ÈñãÂßãÈÅäÊà≤
    function startGame() {
      if (gameState.isPlaying) return;

      gameState.isPlaying = true;
      gameState.clicks = 0;
      gameState.timeRemaining = gameState.gameDuration;
      document.getElementById('startButton').disabled = true;
      document.getElementById('clicksDisplay').textContent = '0 Ê¨°ÈªûÊìä';
      document.getElementById('timerDisplay').textContent = gameState.gameDuration.toFixed(1) + ' Áßí';
      
      // ÂïüÁî®ÈªûÊìäÊåâÈàï
      const mainButton = document.getElementById('mainClickButton');
      if (mainButton) {
        mainButton.disabled = false;
      }
      
      updateClickButtons();

      // Êõ¥Êñ∞Ë®àÊôÇÂô®
      gameState.timerInterval = setInterval(() => {
        gameState.timeRemaining -= 0.1;
        if (gameState.timeRemaining <= 0) {
          gameState.timeRemaining = 0;
          endGame();
        }
        document.getElementById('timerDisplay').textContent = gameState.timeRemaining.toFixed(1) + ' Áßí';
      }, 100);

      // ÂØµÁâ©Â§•‰º¥ËÉΩÂäõÔºöÊâÄÊúâÂØµÁâ©‰ª•Áõ∏ÂêåÈ†ªÁéáÂêåÊôÇËß∏Áôº
      // ÊØèÂÄãÂØµÁâ©‰ª• autoClickerInterval ÁöÑÈñìÈöîËá™ÂãïÈªûÊìä
      if (gameState.autoClickerRate > 0 && gameState.extraButtons > 0) {
        // Ê∏ÖÈô§‰πãÂâçÁöÑÂÆöÊôÇÂô®
        gameState.autoClickerIntervals.forEach(interval => clearInterval(interval));
        gameState.autoClickerIntervals = [];
        
        // ‰ΩøÁî®È†êÂÖàË®àÁÆóÁöÑÈñìÈöîÊôÇÈñìÔºàÊØ´ÁßíÔºâ
        const clickInterval = gameState.autoClickerInterval;
        
        // Êõ¥Êñ∞È°ØÁ§∫ÁöÑÂØ¶ÈöõÁ∏ΩÈªûÊìäÈ†ªÁéá
        const totalClickRate = gameState.autoClickerRate * gameState.extraButtons;
        // Êõ¥Êñ∞È°ØÁ§∫ÔºöÊØèÂÄãÈªûÊìäÂô®È†ªÁéá„ÄÅÊï∏Èáè„ÄÅÁ∏ΩÈ†ªÁéá
        const ratePerButtonElement = document.getElementById('autoClickerRatePerButton');
        const countElement = document.getElementById('autoClickerCount');
        const totalRateElement = document.getElementById('autoClickerTotalRate');
        if (ratePerButtonElement) {
          ratePerButtonElement.textContent = gameState.autoClickerRate.toFixed(2);
        }
        if (countElement) {
          countElement.textContent = gameState.extraButtons;
        }
        if (totalRateElement) {
          totalRateElement.textContent = totalClickRate.toFixed(2);
        }
        
        // ÂâµÂª∫ÂñÆ‰∏ÄÂÆöÊôÇÂô®ÔºåÂêåÊôÇËß∏ÁôºÊâÄÊúâÊåâÈàï
        const interval = setInterval(() => {
          // Ê™¢Êü•ÈÅäÊà≤ÊòØÂê¶ÈÇÑÂú®ÈÄ≤Ë°å
          if (!gameState.isPlaying) {
            clearInterval(interval);
            return;
          }
          
          // ÁÇ∫ÊØèÂÄãÈ°çÂ§ñÊåâÈàïÂ¢ûÂä†ÈªûÊìäÊï∏
          for (let i = 0; i < gameState.extraButtons; i++) {
            gameState.clicks++;
          }
          updateClicksDisplay();
          
          // ÂêåÊôÇËß∏ÁôºÊâÄÊúâÂØµÁâ©Â§•‰º¥ÁöÑÁâπÊïà
          for (let i = 0; i < gameState.extraButtons; i++) {
            const petId = `companionPet${i + 1}`;
            const petCard = document.getElementById(petId);
            if (petCard && gameState.isPlaying) {
              // ÂÖàÁßªÈô§ÂèØËÉΩÂ≠òÂú®ÁöÑÂãïÁï´È°ûÔºåÁ¢∫‰øùÂãïÁï´ËÉΩÈáçÊñ∞Ëß∏Áôº
              petCard.classList.remove('active');
              // ‰ΩøÁî® requestAnimationFrame Á¢∫‰øù DOM Êõ¥Êñ∞ÂæåÂÜçÊ∑ªÂä†ÂãïÁï´
              requestAnimationFrame(() => {
                if (gameState.isPlaying && petCard) {
                  petCard.classList.add('active');
                  
                  // ÂâµÂª∫ÊÑõÂøÉÂãïÁï´ÊïàÊûú
                  createPetHearts(petCard);
                  
                  // ÂãïÁï´ÊôÇÈï∑ÊòØ 0.4s (400ms)ÔºåÊâÄ‰ª•Ë®≠ÁΩÆ 450ms ÂæåÁßªÈô§ÔºåÁ¢∫‰øùÂãïÁï´ÂÆåÊàê
                  setTimeout(() => {
                    if (petCard) {
                      petCard.classList.remove('active');
                    }
                  }, 450);
                }
              });
            }
          }
        }, clickInterval);
        
        gameState.autoClickerIntervals.push(interval);
      }
    }

    // ÂâµÂª∫ÂØµÁâ©ÈªûÊìäÊÑõÂøÉÂãïÁï´
    function createPetHearts(petCard) {
      // ÊØèÊ¨°ÈªûÊìäÂè™ÁîüÊàê1ÂÄãÊÑõÂøÉ
      const heart = document.createElement('div');
      heart.className = 'pet-heart';
      heart.textContent = '‚ù§Ô∏è';
      
      // ÊÑõÂøÉÂá∫ÁèæÂú®ÂØµÁâ©Âç°ÁâáÁöÑÂè≥‰∏äËßí
      heart.style.top = '8px';
      heart.style.right = '8px';
      heart.style.left = 'auto'; // Ê∏ÖÈô§Â∑¶ÂÅ¥ÂÆö‰Ωç
      
      petCard.appendChild(heart);
      
      // ÂãïÁï´ÁµêÊùüÂæåÁßªÈô§ÂÖÉÁ¥†
      setTimeout(() => {
        if (heart.parentNode) {
          heart.remove();
        }
      }, 1200); // ËàáÂãïÁï´ÊôÇÈï∑‰∏ÄËá¥
    }

    // ËôïÁêÜÈªûÊìäÔºàÂÑ™ÂåñÂø´ÈÄüÈÄ£ÈªûÈüøÊáâÔºâ
    let lastClickTime = 0;
    function handleClick(event) {
      if (!gameState.isPlaying) return;
      
      // Èò≤Ê≠¢ÈáçË§áËß∏ÁôºÔºàtouchstart Âíå click ÂèØËÉΩÈÉΩÊúÉËß∏ÁôºÔºå‰ΩÜÂ∑≤ÈÄöÈÅéÊ®ôË®òËôïÁêÜÔºâ
      // ‰øùÁïôÊ≠§Ê©üÂà∂‰ΩúÁÇ∫È°çÂ§ñ‰øùË≠∑ÔºåÈò≤Ê≠¢Ê•µÂø´ÈÄüÁöÑÈÄ£Á∫åËß∏Áôº
      const now = Date.now();
      if (now - lastClickTime < 30) {
        return; // 30ms ÂÖßÂè™ËôïÁêÜ‰∏ÄÊ¨°ÔºàË°åÂãïË£ùÁΩÆÂø´ÈÄüÈÄ£Èªû‰øùË≠∑Ôºâ
      }
      lastClickTime = now;
      
      gameState.clicks++;
      updateClicksDisplay();
      
      // Ëß∏ÁôºÁâπÊïàÂãïÁï´ÔºàÂè™ÊáâÁî®Êñº‰∏ªÊåâÈàïÔºâ
      if (event && event.target) {
        const button = event.target;
        // Á¢∫‰øùÂè™Â∞ç‰∏ªÊåâÈàïÊáâÁî®ÂãïÁï´ÔºåÈÅøÂÖçÂΩ±ÈüøÂÖ∂‰ªñÊåâÈàï
        // Â¶ÇÊûúÈªûÊìäÁöÑÊòØÊåâÈàïÂÖßÁöÑspanÔºåÂâáÊâæÂà∞Áà∂ÊåâÈàï
        const targetButton = button.id === 'mainClickButton' 
          ? button 
          : (button.closest && button.closest('#mainClickButton')) 
            ? button.closest('#mainClickButton')
            : null;
        
        if (targetButton && targetButton.id === 'mainClickButton') {
          // Ëß∏ÁôºÊñáÂ≠ó‰∏ãÊ≤â‰∏äÊµÆÂãïÁï´Ôºà‰ΩøÁî®ËºÉÁü≠ÁöÑÂãïÁï´ÊôÇÈñì‰ª•ÊîØÊåÅÂø´ÈÄüÈÄ£ÈªûÔºâ
          targetButton.classList.add('click-text-animation');
          setTimeout(() => {
            targetButton.classList.remove('click-text-animation');
          }, 300);
          
          // Ëß∏ÁôºËá™ÂãïÈªûÊìäÁâπÊïàÔºàËàáËá™ÂãïÈªûÊìäÊåâÈàïÁõ∏ÂêåÁöÑÁâπÊïàÔºâ
          targetButton.classList.remove('auto-click-animation');
          requestAnimationFrame(() => {
            if (gameState.isPlaying && targetButton) {
              targetButton.classList.add('auto-click-animation');
              setTimeout(() => {
                if (targetButton) {
                  targetButton.classList.remove('auto-click-animation');
                }
              }, 400);
            }
          });
        }
      }
    }

    // Êõ¥Êñ∞ÈªûÊìäÈ°ØÁ§∫
    function updateClicksDisplay() {
      document.getElementById('clicksDisplay').textContent = Math.floor(gameState.clicks) + ' Ê¨°ÈªûÊìä';
    }

    // Ë®àÁÆóÈáëÂπ£ÔºàËàáÂæåÁ´ØÈÇèËºØ‰∏ÄËá¥Ôºâ
    function calculateCoinsEarned(clicks, gameDuration) {
      const baseTime = 10.0;
      if (gameDuration <= baseTime) {
        // Âü∫Á§éÊôÇÈñìÂÖßÁöÑÈªûÊìäÔºåÊØèÊ¨°1ÈáëÂπ£
        return clicks;
      } else {
        // ÊúâÂª∂Èï∑ÊôÇÈñìÔºåÈúÄË¶ÅÂçÄÂàÜÂü∫Á§éÊôÇÈñìÂíåÂª∂Èï∑ÊôÇÈñìÁöÑÈªûÊìä
        // ÂÅáË®≠ÈªûÊìäÂùáÂãªÂàÜ‰ΩàÔºåË®àÁÆóÂü∫Á§éÊôÇÈñìÂíåÂª∂Èï∑ÊôÇÈñìÁöÑÈªûÊìäÊï∏
        // Âª∂Èï∑ÊôÇÈñìÂÖßÁöÑÈªûÊìäÁç≤Âæó2ÂÄçÈáëÂπ£ÔºàÁõ∏Â∞çÊñºÂü∫Á§éÊôÇÈñìÁöÑ1ÈáëÂπ£Ôºâ
        const baseClicks = Math.floor(clicks * (baseTime / gameDuration));
        const extraClicks = clicks - baseClicks;
        return baseClicks + (extraClicks * 2);
      }
    }

    // ÁµêÊùüÈÅäÊà≤
    async function endGame() {
      // ÂÖàÂÅúÊ≠¢ÈÅäÊà≤ÁãÄÊÖãÔºåÈò≤Ê≠¢Êñ∞ÁöÑÂãïÁï´Ëß∏Áôº
      gameState.isPlaying = false;
      
      // Ê∏ÖÈô§Ë®àÊôÇÂô®
      if (gameState.timerInterval) {
        clearInterval(gameState.timerInterval);
        gameState.timerInterval = null;
      }
      
      // Ê∏ÖÈô§ÊâÄÊúâÂØµÁâ©Â§•‰º¥ËÉΩÂäõÂÆöÊôÇÂô®
      gameState.autoClickerIntervals.forEach(interval => {
        if (interval) {
          clearInterval(interval);
        }
      });
      gameState.autoClickerIntervals = [];
      
      // Á≠âÂæÖÊâÄÊúâÂãïÁï´ÂÆåÊàêÂæåÂÜçÁπºÁ∫åÔºàÁµ¶ÂãïÁï´‰∏Ä‰∫õÊôÇÈñìÂÆåÊàêÔºâ
      await new Promise(resolve => setTimeout(resolve, 500));

      const finalClicks = Math.floor(gameState.clicks);
      document.getElementById('timerDisplay').textContent = '0.0 Áßí';
      document.getElementById('startButton').disabled = false;
      
      // Á¶ÅÁî®ÈªûÊìäÊåâÈàïÔºàÈÅäÊà≤ÁµêÊùüÂæåËÆäÁÇ∫ÁÅ∞Ëâ≤Ôºâ
      const mainButton = document.getElementById('mainClickButton');
      if (mainButton) {
        mainButton.disabled = true;
      }

      // ÂÑ™ÂåñÔºöÂÖàÂú®ÂâçÁ´ØË®àÁÆó‰∏¶Á´ãÂç≥È°ØÁ§∫ÁµêÁÆóÁµêÊûú
      const coinsEarned = calculateCoinsEarned(finalClicks, gameState.gameDuration);
      const currentCoins = gameState.userProfile ? gameState.userProfile.coins : 0;
      const newTotalCoins = currentCoins + coinsEarned;
      const newTotalClicks = (gameState.userProfile ? gameState.userProfile.total_clicks : 0) + finalClicks;
      const newTotalGames = (gameState.userProfile ? gameState.userProfile.total_games_played : 0) + 1;
      const isNewBest = !gameState.userProfile || finalClicks > gameState.userProfile.best_clicks_per_round;
      const newBestClicks = isNewBest ? finalClicks : (gameState.userProfile ? gameState.userProfile.best_clicks_per_round : 0);

      // Á´ãÂç≥Êõ¥Êñ∞È°ØÁ§∫ÔºàÊ®ÇËßÄÊõ¥Êñ∞Ôºâ
      if (gameState.userProfile) {
        gameState.userProfile.coins = newTotalCoins;
        gameState.userProfile.total_clicks = newTotalClicks;
        gameState.userProfile.total_games_played = newTotalGames;
        if (isNewBest) {
          gameState.userProfile.best_clicks_per_round = newBestClicks;
        }
        updateProfileDisplay();
      }

      // Á´ãÂç≥È°ØÁ§∫ÁµêÁÆóÁµêÊûú
      showGameResultToast(finalClicks, coinsEarned);

      // Áï∞Ê≠•Êèê‰∫§Âà∞ÂæåÁ´ØÔºà‰∏çÈòªÂ°û UIÔºâ
      (async () => {
        try {
          // È°ØÁ§∫ËºâÂÖ•ÁãÄÊÖã
          const loadingEl = document.getElementById('resultLoading');
          if (loadingEl) {
            loadingEl.style.display = 'block';
          }

          const result = await apiCall('/api/submit-game/', 'POST', {
            clicks: finalClicks,
            game_duration: gameState.gameDuration
          }, false, false);

          // Èö±ËóèËºâÂÖ•ÁãÄÊÖã
          if (loadingEl) {
            loadingEl.style.display = 'none';
          }

          // ‰ΩøÁî®ÂæåÁ´ØËøîÂõûÁöÑÂØ¶ÈöõË≥áÊñôÊõ¥Êñ∞ÔºàÂèØËÉΩÂåÖÂê´ÊàêÂ∞±ÁçéÂãµÁ≠âÔºâ
          if (result.profile) {
            gameState.userProfile = result.profile;
            updateProfileDisplay();
          }

          // È°ØÁ§∫Êñ∞ÊàêÂ∞±
          if (result.new_achievements && result.new_achievements.length > 0) {
            showAchievementNotification(result.new_achievements[0]);
            // Êõ¥Êñ∞Â∑≤Ëß£ÈéñÊàêÂ∞±Á∑©Â≠òÔºåÂÑ™ÂåñÂæΩÁ´†ÈÅ∏ÊìáÈüøÊáâÈÄüÂ∫¶
            const newAchievement = result.new_achievements[0];
            if (!gameState.unlockedAchievements.find(a => a.id === newAchievement.id)) {
              gameState.unlockedAchievements.push({
                id: newAchievement.id,
                name: newAchievement.name,
                icon: newAchievement.icon,
              });
            }
          }

          // ÂÑ™ÂåñÔºöÁõ¥Êé•‰ΩøÁî®ËøîÂõûÁöÑÊ≠∑Âè≤Ë®òÈåÑÔºåÈÅøÂÖçÂÜçÊ¨°Ë´ãÊ±Ç
          if (result.history) {
            displayHistory(result.history);
          } else {
            // Â¶ÇÊûúÊ≤íÊúâËøîÂõûÊ≠∑Âè≤Ë®òÈåÑÔºåÊâçÈáçÊñ∞ËºâÂÖ•ÔºàÂêëÂæåÂÖºÂÆπÔºâ
            loadHistory();
          }
        } catch (error) {
          // ÈåØË™§ËôïÁêÜÔºöÂ¶ÇÊûúÊèê‰∫§Â§±ÊïóÔºåÂõûÊªæÊ®ÇËßÄÊõ¥Êñ∞
          console.error('Êèê‰∫§ÈÅäÊà≤ÁµêÊûúÂ§±Êïó:', error);
          // ÈáçÊñ∞ËºâÂÖ•ÂØ¶ÈöõË≥áÊñô
          try {
            await loadProfile();
          } catch (loadError) {
            console.error('ÈáçÊñ∞ËºâÂÖ•Ë≥áÊñôÂ§±Êïó:', loadError);
          }
        }
      })();
    }

    // Âä†ËºâÂïÜÂ∫ó
    async function loadShop() {
      try {
        const result = await apiCall('/api/shop/');
        displayShopItems(result.items);
      } catch (error) {
        // ÈåØË™§ËôïÁêÜ
      }
    }

    // È°ØÁ§∫ÂïÜÂ∫óÁâ©ÂìÅ
    function displayShopItems(items) {
      const container = document.getElementById('shopItemsContainer');
      container.innerHTML = '';

      items.forEach(item => {
        const itemDiv = document.createElement('div');
        const isDisabled = item.requires_extra_button && !item.can_upgrade;
        itemDiv.className = 'shop-item' + (isDisabled ? ' disabled' : '');
        
        let requirementText = '';
        if (item.requires_extra_button && !item.can_upgrade) {
          requirementText = '<div class="shop-item-requirement">‚ö†Ô∏è ÂâçÁΩÆÊ¢ù‰ª∂ÔºöÈúÄË¶ÅÂÖàË≥ºË≤∑„ÄåË≥ºË≤∑ÂØµÁâ©Â§•‰º¥„Äç</div>';
        }
        
        // Âà§Êñ∑È°ØÁ§∫ÊñáÂ≠ó
        let priceText = '';
        let buttonText = '';
        if (item.can_upgrade) {
          priceText = item.next_level_price + ' üí∞';
          buttonText = 'Ë≥ºË≤∑';
        } else if (item.is_unpurchased) {
          priceText = 'Êú™Ë≥ºË≤∑';
          buttonText = 'Êú™Ë≥ºË≤∑';
        } else {
          priceText = 'Â∑≤ÊªøÁ¥ö';
          buttonText = 'Â∑≤ÊªøÁ¥ö';
        }
        
        itemDiv.innerHTML = `
          <div class="shop-item-header">
            <div class="shop-item-name">${item.name}</div>
            <div class="shop-item-level">Lv.${item.current_level}/${item.max_level}</div>
          </div>
          <div class="shop-item-description">${item.description}</div>
          ${requirementText}
          <div class="shop-item-footer">
            <div class="shop-item-price">
              ${priceText}
            </div>
            <button class="btn btn-primary" 
                    onclick="purchaseItem(${item.id})" 
                    ${!item.can_upgrade ? 'disabled' : ''}>
              ${buttonText}
            </button>
          </div>
        `;
        container.appendChild(itemDiv);
      });
    }

    // Ë≥ºË≤∑Áâ©ÂìÅÁãÄÊÖãÁÆ°ÁêÜ
    let isPurchasing = false;
    const purchasingItems = new Set(); // ËøΩËπ§Ê≠£Âú®Ë≥ºË≤∑ÁöÑÁâ©ÂìÅIDÔºåÈò≤Ê≠¢ÈáçË§áÈªûÊìä

    // Ë≥ºË≤∑Áâ©ÂìÅÔºàÂÑ™ÂåñÁâàÔºöÊ∏õÂ∞ë‰∏çÂøÖË¶ÅÁöÑË≥áÊñôËºâÂÖ•ÔºåÊ∑ªÂä†Èò≤ÈáçË§áÈªûÊìäÊ©üÂà∂Ôºâ
    async function purchaseItem(itemId) {
      // Á¢∫‰øù itemId ÊòØÊï∏Â≠óÔºàËôïÁêÜÂ≠ó‰∏≤Êï∏Â≠óÁöÑÊÉÖÊ≥ÅÔºâ
      const numericItemId = typeof itemId === 'string' ? parseInt(itemId, 10) : itemId;
      if (isNaN(numericItemId) || numericItemId <= 0) {
        showErrorToast('ÈåØË™§', 'ÁÑ°ÊïàÁöÑÁâ©ÂìÅID');
        return;
      }

      // Èò≤Ê≠¢ÈáçË§áÈªûÊìäÔºöÂ¶ÇÊûúË©≤Áâ©ÂìÅÊ≠£Âú®Ë≥ºË≤∑‰∏≠ÔºåÁõ¥Êé•ËøîÂõû
      if (purchasingItems.has(numericItemId)) {
        return;
      }

      // Èò≤Ê≠¢‰∏¶ÁôºË≥ºË≤∑ÔºöÂ¶ÇÊûúÊ≠£Âú®ÈÄ≤Ë°åÂÖ∂‰ªñË≥ºË≤∑Êìç‰ΩúÔºåÊèêÁ§∫Áî®Êà∂
      if (isPurchasing) {
        showErrorToast('ÊèêÁ§∫', 'Ë´ãÁ≠âÂæÖÁï∂ÂâçË≥ºË≤∑ÂÆåÊàê');
        return;
      }

      // Ê®ôË®òÁÇ∫Ë≥ºË≤∑‰∏≠
      isPurchasing = true;
      purchasingItems.add(numericItemId);

      // ÊâæÂà∞Â∞çÊáâÁöÑÊåâÈàï‰∏¶Êõ¥Êñ∞ÁãÄÊÖã
      const button = document.querySelector(`button[onclick="purchaseItem(${numericItemId})"]`);
      const originalButtonText = button ? button.textContent : '';
      if (button) {
        button.disabled = true;
        button.textContent = 'Ë≥ºË≤∑‰∏≠...';
      }

      try {
        const result = await apiCall('/api/purchase/', 'POST', { item_id: numericItemId }, false, true);
        
        if (result.success) {
          // ÂÑ™ÂåñÔºöÂè™Êõ¥Êñ∞ÂøÖË¶ÅÁöÑË≥áÊñôÔºåËÄå‰∏çÊòØÈáçÊñ∞ËºâÂÖ•Êï¥ÂÄãÂïÜÂ∫ó
          // 1. Êõ¥Êñ∞Áé©ÂÆ∂ÈáëÂπ£ÔºàÂæûÂõûÊáâ‰∏≠Áç≤ÂèñÔºâ
          if (gameState.userProfile) {
            gameState.userProfile.coins = result.coins_remaining;
            updateProfileDisplay();
          }

          // 2. Êõ¥Êñ∞Ë©≤Áâ©ÂìÅÁöÑUIÁãÄÊÖãÔºàÈÅøÂÖçÈáçÊñ∞ËºâÂÖ•Êï¥ÂÄãÂïÜÂ∫óÔºâ
          updateShopItemUI(numericItemId, result.new_level, result.coins_remaining, result);

          // 3. Êõ¥Êñ∞ gameState.purchasesÔºàÊâãÂãïÊõ¥Êñ∞Ë≥ºË≤∑Ë®òÈåÑÔºåÈÅøÂÖçÈáçÊñ∞ËºâÂÖ•Êï¥ÂÄã profileÔºâ
          // ÈúÄË¶ÅÂæûÂïÜÂ∫óË≥áÊñô‰∏≠Áç≤ÂèñÁâ©ÂìÅÈ°ûÂûãÔºåÊàñËÄÖÈáçÊñ∞ËºâÂÖ• profile
          // ÁÇ∫‰∫ÜÁ¢∫‰øùÊï∏Êìö‰∏ÄËá¥ÊÄßÔºåÈáçÊñ∞ËºâÂÖ• profileÔºà‰ΩÜÂè™Êõ¥Êñ∞ purchases ÈÉ®ÂàÜÔºâ
          try {
            const profileResult = await apiCall('/api/profile/', 'GET', null, true);
            if (profileResult && profileResult.purchases) {
              gameState.purchases = profileResult.purchases;
            }
          } catch (profileError) {
            console.error('Êõ¥Êñ∞Ë≥ºË≤∑Ë®òÈåÑÂ§±Êïó:', profileError);
          }

          // 4. Êõ¥Êñ∞ÈÅäÊà≤ÂçáÁ¥öÁãÄÊÖãÔºàÂ¶ÇÊûúË≥ºË≤∑ÁöÑÊòØÈÅäÊà≤Áõ∏ÈóúÁâ©ÂìÅÔºâ
          updateGameUpgrades();

          // È°ØÁ§∫ÁæéÂåñÁöÑË≥ºË≤∑ÊàêÂäüÈÄöÁü•
          showPurchaseToast(result.item_name, result.new_level);
        }
      } catch (error) {
        // ÈåØË™§Â∑≤Âú® apiCall ‰∏≠ËôïÁêÜÔºà‰ΩøÁî® ToastÔºâ
        // Â¶ÇÊûúË≥ºË≤∑Â§±ÊïóÔºåÂèØËÉΩÈúÄË¶ÅÈáçÊñ∞ËºâÂÖ•ÂïÜÂ∫ó‰ª•Á¢∫‰øùÁãÄÊÖã‰∏ÄËá¥
        if (error.message && !error.message.includes('ÈáëÂπ£‰∏çË∂≥') && !error.message.includes('Â∑≤ÈÅîÂà∞ÊúÄÂ§ßÁ≠âÁ¥ö')) {
          // Â∞çÊñºÂÖ∂‰ªñÈåØË™§ÔºàÂ¶ÇË≥áÊñôÂ∫´ÈåØË™§ÔºâÔºåÈáçÊñ∞ËºâÂÖ•ÂïÜÂ∫ó‰ª•Á¢∫‰øùÁãÄÊÖã‰∏ÄËá¥
          try {
            await loadShop();
          } catch (reloadError) {
            console.error('ÈáçÊñ∞ËºâÂÖ•ÂïÜÂ∫óÂ§±Êïó:', reloadError);
          }
        }
      } finally {
        // ÊÅ¢Âæ©ÊåâÈàïÁãÄÊÖã
        if (button) {
          button.disabled = false;
          button.textContent = originalButtonText;
        }
        
        // Ê∏ÖÈô§Ë≥ºË≤∑ÁãÄÊÖã
        isPurchasing = false;
        purchasingItems.delete(numericItemId);
      }
    }

    // Êõ¥Êñ∞ÂñÆÂÄãÂïÜÂ∫óÁâ©ÂìÅÁöÑUIÔºàÂÑ™ÂåñÔºöÈÅøÂÖçÈáçÊñ∞ËºâÂÖ•Êï¥ÂÄãÂïÜÂ∫óÔºâ
    function updateShopItemUI(itemId, newLevel, coinsRemaining, purchaseResult) {
      const container = document.getElementById('shopItemsContainer');
      if (!container) return;

      // ÊâæÂà∞Ë©≤Áâ©ÂìÅÁöÑÂÆπÂô®
      const itemDivs = container.querySelectorAll('.shop-item');
      for (const itemDiv of itemDivs) {
        const button = itemDiv.querySelector('button[onclick*="purchaseItem"]');
        if (button && button.getAttribute('onclick').includes(`purchaseItem(${itemId})`)) {
          // Êõ¥Êñ∞Á≠âÁ¥öÈ°ØÁ§∫
          const levelElement = itemDiv.querySelector('.shop-item-level');
          if (levelElement && purchaseResult.max_level) {
            levelElement.textContent = `Lv.${newLevel}/${purchaseResult.max_level}`;
          }

          // Êõ¥Êñ∞ÂÉπÊ†ºÂíåÊåâÈàïÁãÄÊÖã
          const priceElement = itemDiv.querySelector('.shop-item-price');
          
          if (purchaseResult.can_upgrade && purchaseResult.next_level_price) {
            // ÂèØ‰ª•ÂçáÁ¥öÔºåÈ°ØÁ§∫‰∏ã‰∏ÄÁ¥öÂÉπÊ†º
            priceElement.textContent = `${purchaseResult.next_level_price} üí∞`;
            button.textContent = 'Ë≥ºË≤∑';
            button.disabled = false;
            itemDiv.classList.remove('disabled');
            
            // ÁßªÈô§ÂâçÁΩÆÊ¢ù‰ª∂ÊèêÁ§∫ÔºàÂ¶ÇÊûúÂ≠òÂú®Ôºâ
            const requirementText = itemDiv.querySelector('.shop-item-requirement');
            if (requirementText) {
              requirementText.remove();
            }
          } else {
            // Â∑≤ÈÅîÂà∞ÊúÄÂ§ßÁ≠âÁ¥ö
            priceElement.textContent = 'Â∑≤ÊªøÁ¥ö';
            button.textContent = 'Â∑≤ÊªøÁ¥ö';
            button.disabled = true;
            itemDiv.classList.add('disabled');
          }
          break;
        }
      }
    }

    // Ë≥ºË≤∑ÈÄöÁü•ÈöäÂàó
    let purchaseToastQueue = [];
    let purchaseToastTimer = null;
    let isPurchaseToastShowing = false;

    // È°ØÁ§∫Ë≥ºË≤∑ÊàêÂäüÈÄöÁü•Ôºà‰ΩøÁî®ÈöäÂàóÁ≥ªÁµ±Ôºâ
    function showPurchaseToast(itemName, newLevel) {
      // Â∞áÈÄöÁü•Âä†ÂÖ•ÈöäÂàóÔºàÂåÖÂê´ÂïÜÂìÅÂêçÁ®±ÂíåÁ≠âÁ¥öÔºâ
      purchaseToastQueue.push({ itemName, newLevel });
      
      // Â¶ÇÊûúÁï∂ÂâçÊ≤íÊúâÈÄöÁü•Âú®È°ØÁ§∫ÔºåÁ´ãÂç≥È°ØÁ§∫‰∏ã‰∏ÄÂÄã
      if (!isPurchaseToastShowing) {
        processPurchaseToastQueue();
      }
    }

    // ËôïÁêÜË≥ºË≤∑ÈÄöÁü•ÈöäÂàó
    function processPurchaseToastQueue() {
      // Â¶ÇÊûúÈöäÂàóÁÇ∫Á©∫ÔºåÈáçÁΩÆÁãÄÊÖã
      if (purchaseToastQueue.length === 0) {
        isPurchaseToastShowing = false;
        return;
      }

      // Ê®ôË®òÁÇ∫Ê≠£Âú®È°ØÁ§∫
      isPurchaseToastShowing = true;
      
      // ÂæûÈöäÂàó‰∏≠ÂèñÂá∫Á¨¨‰∏ÄÂÄãÈÄöÁü•
      const notification = purchaseToastQueue.shift();
      const toast = document.getElementById('purchaseToast');
      const messageEl = document.getElementById('purchaseToastMessage');
      
      // Ë®≠ÁΩÆÈÄöÁü•ÂÖßÂÆπÔºàÂåÖÂê´ÂïÜÂìÅÂêçÁ®±ÂíåÁ≠âÁ¥öÔºâ
      if (notification.itemName && notification.newLevel) {
        messageEl.textContent = `${notification.itemName} Â∑≤ÂçáÁ¥öÂà∞Á≠âÁ¥ö ${notification.newLevel}`;
      } else if (notification.itemName) {
        messageEl.textContent = `${notification.itemName} Â∑≤ÊàêÂäüË≥ºË≤∑`;
      } else if (notification.newLevel) {
        messageEl.textContent = `Â∑≤ÂçáÁ¥öÂà∞Á≠âÁ¥ö ${notification.newLevel}`;
      } else {
        messageEl.textContent = 'Áâ©ÂìÅÂ∑≤ÊàêÂäüË≥ºË≤∑';
      }
      
      // È°ØÁ§∫ÈÄöÁü•
      toast.classList.add('show');
      
      // Ê∏ÖÈô§‰πãÂâçÁöÑÂÆöÊôÇÂô®ÔºàÂ¶ÇÊûúÂ≠òÂú®Ôºâ
      if (purchaseToastTimer) {
        clearTimeout(purchaseToastTimer);
      }
      
      // Ë®≠ÁΩÆËá™ÂãïÈóúÈñâÊôÇÈñìÔºàÊ†πÊìöÈöäÂàóÈï∑Â∫¶Ë™øÊï¥ÔºåÂ¶ÇÊûúÊúâÊõ¥Â§öÈÄöÁü•Á≠âÂæÖÔºåÈ°ØÁ§∫ÊôÇÈñìÁ®çÁü≠Ôºâ
      const displayTime = purchaseToastQueue.length > 0 ? 2000 : 3000;
      purchaseToastTimer = setTimeout(() => {
        closePurchaseToast();
        // ÈóúÈñâÂæåËôïÁêÜ‰∏ã‰∏ÄÂÄãÈÄöÁü•ÔºàÂª∂ÈÅ≤‰∏ÄÈªûËÆìÂãïÁï´ÂÆåÊàêÔºâ
        setTimeout(() => {
          processPurchaseToastQueue();
        }, 400);
      }, displayTime);
    }

    // ÈóúÈñâË≥ºË≤∑ÊàêÂäüÈÄöÁü•
    function closePurchaseToast() {
      const toast = document.getElementById('purchaseToast');
      toast.classList.remove('show');
      
      // Ê∏ÖÈô§ÂÆöÊôÇÂô®
      if (purchaseToastTimer) {
        clearTimeout(purchaseToastTimer);
        purchaseToastTimer = null;
      }
      
      // ÈáçÁΩÆÈ°ØÁ§∫ÁãÄÊÖãÔºåËÆìÈöäÂàóÁπºÁ∫åËôïÁêÜ
      isPurchaseToastShowing = false;
    }

    // ÊâãÂãïÈóúÈñâ‰∏¶ËôïÁêÜ‰∏ã‰∏ÄÂÄãÈÄöÁü•
    function closePurchaseToastAndProcessNext() {
      closePurchaseToast();
      // Âª∂ÈÅ≤‰∏ÄÈªûËÆìÈóúÈñâÂãïÁï´ÂÆåÊàêÔºåÁÑ∂ÂæåËôïÁêÜ‰∏ã‰∏ÄÂÄãÈÄöÁü•
      setTimeout(() => {
        processPurchaseToastQueue();
      }, 400);
    }

    // ÈåØË™§ÊèêÁ§∫ Toast Áõ∏ÈóúÂáΩÊï∏
    let errorToastTimer = null;

    // È°ØÁ§∫ÈåØË™§ÊèêÁ§∫ Toast
    function showErrorToast(title, errorData) {
      const toast = document.getElementById('errorToast');
      const titleEl = document.getElementById('errorToastTitle');
      const messageEl = document.getElementById('errorToastMessage');
      
      titleEl.textContent = title;
      
      // Â¶ÇÊûúÊòØÈáëÂπ£‰∏çË∂≥ÈåØË™§ÔºåÈ°ØÁ§∫Ë©≥Á¥∞Ë≥áË®ä
      if (title === 'ÈáëÂπ£‰∏çË∂≥' && typeof errorData === 'object' && errorData.current_coins !== undefined) {
        const currentCoins = errorData.current_coins || 0;
        const requiredCoins = errorData.required_coins || 0;
        const shortage = errorData.shortage || 0;
        messageEl.innerHTML = `
          Áï∂ÂâçÈáëÂπ£Ôºö<strong>${currentCoins.toLocaleString()} üí∞</strong><br>
          ÈúÄË¶ÅÈáëÂπ£Ôºö<strong>${requiredCoins.toLocaleString()} üí∞</strong><br>
          ÈÇÑÁº∫Â∞ëÔºö<strong style="color: #ffd700;">${shortage.toLocaleString()} üí∞</strong>
        `;
      } else {
        // ÂÖ∂‰ªñÈåØË™§ÔºåÈ°ØÁ§∫ÈåØË™§Ë®äÊÅØ
        messageEl.textContent = typeof errorData === 'string' ? errorData : (errorData.error || 'ÁôºÁîüÈåØË™§');
      }
      
      // È°ØÁ§∫ Toast
      toast.classList.add('show');
      
      // Ê∏ÖÈô§‰πãÂâçÁöÑË®àÊôÇÂô®
      if (errorToastTimer) {
        clearTimeout(errorToastTimer);
      }
      
      // Ëá™ÂãïÈóúÈñâÔºà5ÁßíÂæåÔºâ
      errorToastTimer = setTimeout(() => {
        closeErrorToast();
      }, 5000);
    }

    // ÈóúÈñâÈåØË™§ÊèêÁ§∫ Toast
    function closeErrorToast() {
      const toast = document.getElementById('errorToast');
      toast.classList.remove('show');
      
      if (errorToastTimer) {
        clearTimeout(errorToastTimer);
        errorToastTimer = null;
      }
    }

    // ÈÅäÊà≤ÁµêÁÆó Toast Áõ∏ÈóúÂáΩÊï∏
    let gameResultToastTimer = null;

    // È°ØÁ§∫ÈÅäÊà≤ÁµêÁÆó Toast
    function showGameResultToast(clicks, coinsEarned) {
      const toast = document.getElementById('gameResultToast');
      const clicksEl = document.getElementById('resultClicks');
      const coinsEl = document.getElementById('resultCoins');
      
      if (clicksEl) {
        clicksEl.textContent = clicks.toLocaleString();
      }
      if (coinsEl) {
        coinsEl.textContent = `+${coinsEarned.toLocaleString()} üí∞`;
      }
      
      // È°ØÁ§∫ Toast
      toast.classList.add('show');
      
      // Ê∏ÖÈô§‰πãÂâçÁöÑË®àÊôÇÂô®
      if (gameResultToastTimer) {
        clearTimeout(gameResultToastTimer);
      }
      
      // Ëá™ÂãïÈóúÈñâÔºà8ÁßíÂæåÔºåÁµ¶Áî®Êà∂Ë∂≥Â§†ÊôÇÈñìÊü•ÁúãÔºâ
      gameResultToastTimer = setTimeout(() => {
        closeGameResultToast();
      }, 8000);
    }

    // ÈóúÈñâÈÅäÊà≤ÁµêÁÆó Toast
    function closeGameResultToast() {
      const toast = document.getElementById('gameResultToast');
      toast.classList.remove('show');
      
      if (gameResultToastTimer) {
        clearTimeout(gameResultToastTimer);
        gameResultToastTimer = null;
      }
    }

    // ÊâìÈñãÂïÜÂ∫ó
    function openShop() {
      document.getElementById('shopModal').classList.add('active');
      loadShop();
    }

    // ÈóúÈñâÂïÜÂ∫ó
    function closeShop() {
      document.getElementById('shopModal').classList.remove('active');
    }

    // Âä†ËºâÊàêÂ∞±
    async function loadAchievements() {
      try {
        const result = await apiCall('/api/achievements/');
        displayAchievements(result.achievements);
        // Êõ¥Êñ∞Â∑≤Ëß£ÈéñÊàêÂ∞±Á∑©Â≠òÔºåÂÑ™ÂåñÂæΩÁ´†ÈÅ∏ÊìáÈüøÊáâÈÄüÂ∫¶
        const unlockedAchievements = result.achievements.filter(a => a.unlocked);
        gameState.unlockedAchievements = unlockedAchievements.map(a => ({
          id: a.id,
          name: a.name,
          icon: a.icon,
        }));
      } catch (error) {
        // ÈåØË™§ËôïÁêÜ
      }
    }

    // È°ØÁ§∫ÊàêÂ∞±
    function displayAchievements(achievements) {
      const container = document.getElementById('achievementsContainer');
      container.innerHTML = '';

      achievements.forEach(achievement => {
        const card = document.createElement('div');
        card.className = 'achievement-card' + (achievement.unlocked ? ' unlocked' : '');
        card.innerHTML = `
          <div class="achievement-icon">${achievement.icon}</div>
          <div class="achievement-name">${achievement.name}</div>
          <div class="achievement-description">${achievement.description}</div>
          ${achievement.reward_coins > 0 ? `<div style="margin-top: 5px; color: #f59e0b;">ÁçéÂãµ: ${achievement.reward_coins} üí∞</div>` : ''}
        `;
        container.appendChild(card);
      });
    }

    // ÊâìÈñãÊàêÂ∞±
    function openAchievements() {
      document.getElementById('achievementsModal').classList.add('active');
      loadAchievements();
    }

    // ÈóúÈñâÊàêÂ∞±
    function closeAchievements() {
      document.getElementById('achievementsModal').classList.remove('active');
    }

    // ÊâìÈñãÈÅäÊà≤Ë™™Êòé
    function openGameHelp() {
      document.getElementById('gameHelpModal').classList.add('active');
    }

    // ÈóúÈñâÈÅäÊà≤Ë™™Êòé
    function closeGameHelp() {
      document.getElementById('gameHelpModal').classList.remove('active');
    }

    // ÈÅ∏ÊìáÂæΩÁ´†Ê¨Ñ‰Ωç
    let currentBadgeSlot = null;
    async function selectBadge(slotNumber) {
      currentBadgeSlot = slotNumber;
      
      // ÂÑ™ÂåñÔºöÂÖàÊ™¢Êü•Á∑©Â≠òÁöÑÂ∑≤Ëß£ÈéñÊàêÂ∞±ÂàóË°®ÔºåÊèê‰æõÂç≥ÊôÇÂèçÈ•ã
      const cachedAchievements = gameState.unlockedAchievements || [];
      
      // Â¶ÇÊûúÁ∑©Â≠ò‰∏≠ÊúâÊàêÂ∞±ÔºåÁ´ãÂç≥È°ØÁ§∫ÔºàÁÑ°ÈúÄÁ≠âÂæÖ APIÔºâ
      if (cachedAchievements.length > 0) {
        displayBadgeSelection(cachedAchievements);
        document.getElementById('badgeSelectModal').classList.add('active');
        return;
      }
      
      // Â¶ÇÊûúÁ∑©Â≠òÁÇ∫Á©∫ÔºåÂÖàÈ°ØÁ§∫ÊèêÁ§∫ÔºàÂç≥ÊôÇÂèçÈ•ãÔºâ
      // ÂêåÊôÇÂú®ËÉåÊôØÂà∑Êñ∞ÊàêÂ∞±ÂàóË°®Ôºà‰ª•Èò≤Á∑©Â≠òÈÅéÊúüÔºâ
      await customAlert('ÊÇ®ÈÇÑÊ≤íÊúâËß£Èéñ‰ªª‰ΩïÊàêÂ∞±ÔºÅ', 'ÊèêÁ§∫', '‚ÑπÔ∏è');
      
      // Âú®ËÉåÊôØÂà∑Êñ∞ÊàêÂ∞±ÂàóË°®ÔºåÊõ¥Êñ∞Á∑©Â≠òÔºà‰∏çÈòªÂ°ûÁî®Êà∂Êìç‰ΩúÔºâ
      try {
        const result = await apiCall('/api/achievements/', 'GET', null, true); // ‰ΩøÁî®ÈùúÈªòÊ®°Âºè
        const unlockedAchievements = result.achievements.filter(a => a.unlocked);
        // Á¢∫‰øùÁ∑©Â≠òÊ†ºÂºè‰∏ÄËá¥ÔºàÂè™‰øùÂ≠òÈúÄË¶ÅÁöÑÊ¨Ñ‰ΩçÔºâ
        gameState.unlockedAchievements = unlockedAchievements.map(a => ({
          id: a.id,
          name: a.name,
          icon: a.icon,
        }));
      } catch (error) {
        // ÈùúÈªòËôïÁêÜÈåØË™§Ôºå‰∏çÂΩ±ÈüøÁî®Êà∂È´îÈ©ó
        console.error('Âà∑Êñ∞ÊàêÂ∞±ÂàóË°®Â§±Êïó:', error);
      }
    }

    // È°ØÁ§∫ÂæΩÁ´†ÈÅ∏ÊìáÂàóË°®
    function displayBadgeSelection(achievements) {
      const container = document.getElementById('badgeSelectContainer');
      container.innerHTML = '';
      
      // Ê∑ªÂä†ÊàêÂ∞±ÈÅ∏È†Ö
      achievements.forEach(achievement => {
        const badgeOption = document.createElement('div');
        badgeOption.style.cssText = 'text-align: center; padding: 15px; border: 2px solid #e0e0e0; border-radius: 8px; cursor: pointer; background: white; transition: all 0.3s; height: 100px; display: flex; flex-direction: column; justify-content: center; align-items: center; box-sizing: border-box;';
        badgeOption.innerHTML = `
          <div style="font-size: 32px; margin-bottom: 5px; line-height: 1; flex-shrink: 0;">${achievement.icon}</div>
          <div style="font-size: 12px; color: #666; word-break: break-word; overflow: hidden; text-overflow: ellipsis; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; line-height: 1.3; max-height: 2.6em;">${achievement.name}</div>
        `;
        badgeOption.onclick = () => {
          updateBadge(currentBadgeSlot, achievement.id);
        };
        badgeOption.onmouseenter = function() {
          this.style.borderColor = '#667eea';
          this.style.background = '#f0f4ff';
        };
        badgeOption.onmouseleave = function() {
          this.style.borderColor = '#e0e0e0';
          this.style.background = 'white';
        };
        container.appendChild(badgeOption);
      });
    }

    // Êõ¥Êñ∞ÂæΩÁ´†
    async function updateBadge(slotNumber, achievementId) {
      try {
        const badges = gameState.badges || [null, null, null];
        const badgeIds = badges.map(b => b ? b.id : null);
        badgeIds[slotNumber - 1] = achievementId;
        
        const result = await apiCall('/api/update-badges/', 'POST', {
          badge_1_id: badgeIds[0],
          badge_2_id: badgeIds[1],
          badge_3_id: badgeIds[2],
        });
        
        if (result.success) {
          gameState.badges = result.badges;
          updateBadgesDisplay();
          closeBadgeSelect();
        }
      } catch (error) {
        await customAlert('Êõ¥Êñ∞ÂæΩÁ´†Â§±ÊïóÔºö' + (error.message || 'Êú™Áü•ÈåØË™§'), 'ÈåØË™§', '‚ö†Ô∏è');
      }
    }

    // Ê∏ÖÈô§Áï∂ÂâçÊ¨Ñ‰Ωç
    function clearBadgeSlot() {
      if (currentBadgeSlot) {
        updateBadge(currentBadgeSlot, null);
      }
    }

    // ÈóúÈñâÂæΩÁ´†ÈÅ∏ÊìáÊ®°ÊÖãÊ°Ü
    function closeBadgeSelect() {
      document.getElementById('badgeSelectModal').classList.remove('active');
      currentBadgeSlot = null;
    }

    // È°ØÁ§∫ÊàêÂ∞±ÈÄöÁü•
    function showAchievementNotification(achievement) {
      document.getElementById('notificationIcon').textContent = achievement.icon;
      document.getElementById('notificationTitle').textContent = achievement.name;
      document.getElementById('notificationDescription').textContent = achievement.description;
      if (achievement.reward_coins > 0) {
        document.getElementById('notificationDescription').textContent += `\nÁç≤Âæó ${achievement.reward_coins} ÈáëÂπ£ÔºÅ`;
      }
      document.getElementById('achievementNotification').classList.add('active');
    }

    // ÈóúÈñâÊàêÂ∞±ÈÄöÁü•
    function closeAchievementNotification() {
      document.getElementById('achievementNotification').classList.remove('active');
    }

    // ÂàáÊèõË®≠ÂÆö‰∏ãÊãâÈÅ∏ÂñÆ
    function toggleSettings() {
      const dropdown = document.getElementById('settingsDropdown');
      dropdown.classList.toggle('active');
    }

    // ÈóúÈñâË®≠ÂÆö‰∏ãÊãâÈÅ∏ÂñÆ
    function closeSettings() {
      const dropdown = document.getElementById('settingsDropdown');
      dropdown.classList.remove('active');
    }

    // ÊâìÈñãÂ∏≥Ëôü‰ªãÈù¢ÔºàÂÉÖÁé©ÂÆ∂Ë≥áÊñôÔºâ
    function openAccount() {
      document.getElementById('accountModal').classList.add('active');
      loadAccountInfo();
    }

    // ÈóúÈñâÂ∏≥Ëôü‰ªãÈù¢
    function closeAccount() {
      document.getElementById('accountModal').classList.remove('active');
    }

    // ÊâìÈñãÊ≠∑Âè≤Ë®òÈåÑ‰ªãÈù¢
    function openHistory() {
      // ÂÖàÊ∏ÖÈô§ËàäÁöÑÊ≠∑Âè≤Ë®òÈåÑÈ°ØÁ§∫ÔºåÈÅøÂÖçÈ°ØÁ§∫‰∏ä‰∏ÄÂÄãÁî®Êà∂ÁöÑË®òÈåÑ
      document.getElementById('detailedHistoryContainer').innerHTML = '<p style="color: #666; text-align: center; padding: 20px;">ËºâÂÖ•‰∏≠...</p>';
      document.getElementById('historyModal').classList.add('active');
      loadDetailedHistory();
    }

    // ÈóúÈñâÊ≠∑Âè≤Ë®òÈåÑ‰ªãÈù¢
    function closeHistory() {
      document.getElementById('historyModal').classList.remove('active');
    }

    // Âä†ËºâÂ∏≥ËôüË≥áË®ä
    function loadAccountInfo() {
      if (!gameState.userProfile) return;
      
      const container = document.getElementById('accountProfileInfo');
      const profile = gameState.userProfile;
      
      // Ê†ºÂºèÂåñÂâµÁ´ãÊó•Êúü
      let createdDateStr = 'Êú™Áü•';
      if (profile.created_at) {
        const createdDate = new Date(profile.created_at);
        createdDateStr = createdDate.toLocaleString('zh-TW', {
          year: 'numeric',
          month: '2-digit',
          day: '2-digit',
          hour: '2-digit',
          minute: '2-digit'
        });
      }
      
      container.innerHTML = `
        <div style="margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #e0e0e0;">
          <h4 style="margin-bottom: 15px; color: #667eea;">Âü∫Êú¨Ë≥áÊñô</h4>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
            <div>
              <strong>üë§ Â∏≥ËôüÂêçÁ®±:</strong> ${profile.username || 'Êú™Áü•'}
            </div>
            <div>
              <strong>üìÖ ÂâµÁ´ãÊó•Êúü:</strong> ${createdDateStr}
            </div>
            <div>
              <strong>‚öîÔ∏è Â∞çÊà∞ÂãùÂ†¥Êï∏:</strong> ${(profile.battle_wins || 0).toLocaleString()}
            </div>
          </div>
        </div>
        <div>
          <h4 style="margin-bottom: 15px; color: #667eea;">ÈÅäÊà≤Áµ±Ë®à</h4>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
            <div>
              <strong>üí∞ ÈáëÂπ£:</strong> ${profile.coins.toLocaleString()}
            </div>
            <div>
              <strong>Á∏ΩÈªûÊìäÊï∏:</strong> ${profile.total_clicks.toLocaleString()}
            </div>
            <div>
              <strong>ÂñÆÂ±ÄÊúÄ‰Ω≥:</strong> ${profile.best_clicks_per_round.toLocaleString()}
            </div>
            <div>
              <strong>ÈÅäÊà≤Â±ÄÊï∏:</strong> ${profile.total_games_played.toLocaleString()}
            </div>
          </div>
        </div>
      `;
    }

    // Âä†ËºâË©≥Á¥∞Ê≠∑Âè≤Ë®òÈåÑÔºàÂõ∫ÂÆöÈ°ØÁ§∫20Á≠ÜÔºâ
    async function loadDetailedHistory() {
      try {
        const result = await apiCall('/api/history/?limit=20');
        displayDetailedHistory(result.history);
      } catch (error) {
        // ÈåØË™§ËôïÁêÜ
        const container = document.getElementById('detailedHistoryContainer');
        container.innerHTML = '<p style="color: #666; text-align: center; padding: 20px;">ËºâÂÖ•Ê≠∑Âè≤Ë®òÈåÑÊôÇÁôºÁîüÈåØË™§</p>';
      }
    }

    // È°ØÁ§∫Ë©≥Á¥∞Ê≠∑Âè≤Ë®òÈåÑ
    function displayDetailedHistory(history) {
      const container = document.getElementById('detailedHistoryContainer');
      if (history.length === 0) {
        container.innerHTML = '<p style="color: #666; text-align: center; padding: 20px;">Êö´ÁÑ°Ë®òÈåÑ</p>';
        return;
      }

      let html = '<table style="width: 100%; border-collapse: collapse; font-size: 14px;">';
      html += '<thead>';
      html += '<tr style="background: #f0f0f0;">';
      html += '<th style="padding: 10px; border-bottom: 2px solid #e0e0e0; text-align: left; white-space: nowrap; min-width: 150px;">Êó•ÊúüÊôÇÈñì</th>';
      html += '<th style="padding: 10px; border-bottom: 2px solid #e0e0e0; text-align: center; white-space: nowrap; min-width: 80px;">ÈªûÊìäÊï∏</th>';
      html += '<th style="padding: 10px; border-bottom: 2px solid #e0e0e0; text-align: center; white-space: nowrap; min-width: 100px;">ÈÅäÊà≤ÊôÇÈï∑</th>';
      html += '<th style="padding: 10px; border-bottom: 2px solid #e0e0e0; text-align: center; white-space: nowrap; min-width: 120px;">Áç≤ÂæóÈáëÂπ£</th>';
      html += '<th style="padding: 10px; border-bottom: 2px solid #e0e0e0; text-align: center; white-space: nowrap; min-width: 100px;">ÈªûÊìäÁéá</th>';
      html += '</tr>';
      html += '</thead>';
      html += '<tbody>';
      
      history.forEach(session => {
        const date = new Date(session.played_at);
        const dateStr = date.toLocaleString('zh-TW', {
          year: 'numeric',
          month: '2-digit',
          day: '2-digit',
          hour: '2-digit',
          minute: '2-digit',
          second: '2-digit'
        });
        const clickRate = session.game_duration > 0 
          ? (session.clicks / session.game_duration).toFixed(2) 
          : '0.00';
        
        html += `<tr style="border-bottom: 1px solid #e0e0e0;">`;
        html += `<td style="padding: 10px; white-space: nowrap;">${dateStr}</td>`;
        html += `<td style="padding: 10px; text-align: center; font-weight: bold; white-space: nowrap;">${session.clicks.toLocaleString()}</td>`;
        html += `<td style="padding: 10px; text-align: center; white-space: nowrap;">${session.game_duration.toFixed(1)} Áßí</td>`;
        html += `<td style="padding: 10px; text-align: center; color: #f59e0b; font-weight: bold; white-space: nowrap;">+${session.coins_earned.toLocaleString()} üí∞</td>`;
        html += `<td style="padding: 10px; text-align: center; white-space: nowrap;">${clickRate} Ê¨°/Áßí</td>`;
        html += `</tr>`;
      });
      
      html += '</tbody>';
      html += '</table>';
      container.innerHTML = html;
    }

    // Âä†ËºâÊ≠∑Âè≤Ë®òÈåÑ
    async function loadHistory() {
      try {
        const result = await apiCall('/api/history/?limit=10');
        displayHistory(result.history);
      } catch (error) {
        // ÈåØË™§ËôïÁêÜ
      }
    }

    // È°ØÁ§∫Ê≠∑Âè≤Ë®òÈåÑ
    function displayHistory(history) {
      const container = document.getElementById('historyContainer');
      if (history.length === 0) {
        container.innerHTML = '<p style="color: #666;">Êö´ÁÑ°Ë®òÈåÑ</p>';
        return;
      }

      let html = '<table style="width: 100%; border-collapse: collapse;">';
      html += '<tr><th style="padding: 8px; border-bottom: 2px solid #e0e0e0; text-align: center; white-space: nowrap; min-width: 60px;">ÈªûÊìä</th><th style="padding: 8px; border-bottom: 2px solid #e0e0e0; text-align: center; white-space: nowrap; min-width: 60px;">ÊôÇÈï∑</th><th style="padding: 8px; border-bottom: 2px solid #e0e0e0; text-align: center; white-space: nowrap; min-width: 80px;">ÈáëÂπ£</th></tr>';
      
      history.forEach(session => {
        const date = new Date(session.played_at);
        html += `<tr>
          <td style="padding: 8px; border-bottom: 1px solid #e0e0e0; text-align: center; white-space: nowrap;">${session.clicks}</td>
          <td style="padding: 8px; border-bottom: 1px solid #e0e0e0; text-align: center; white-space: nowrap;">${session.game_duration.toFixed(1)} Áßí</td>
          <td style="padding: 8px; border-bottom: 1px solid #e0e0e0; text-align: center; white-space: nowrap;">+${session.coins_earned} üí∞</td>
        </tr>`;
      });
      
      html += '</table>';
      container.innerHTML = html;
    }

    // Èò≤Ê≠¢ÊâãÊ©üÈÄ£ÈªûÊîæÂ§ß - ÊîπÈÄ≤ÁâàÔºöÂè™ÈòªÊ≠¢ÁúüÊ≠£ÁöÑÈõôÊìäÁ∏ÆÊîæÔºå‰∏çÂΩ±ÈüøÂø´ÈÄüÈÄ£Èªû
    let lastTouchEnd = 0;
    let lastTouchPosition = { x: 0, y: 0 };
    document.addEventListener('touchend', function (event) {
      // Âè™ÈòªÊ≠¢ÈùûÊåâÈàïÂçÄÂüüÁöÑÂø´ÈÄüÈõôÊìäÔºàÈò≤Ê≠¢Á∏ÆÊîæÔºâ
      const target = event.target;
      const isButton = target.tagName === 'BUTTON' || target.closest('button') || target.closest('.click-button');
      
      if (!isButton) {
        const now = Date.now();
        const touch = event.changedTouches[0];
        const currentPos = { x: touch.clientX, y: touch.clientY };
        
        // Ë®àÁÆóË∑ùÈõ¢ÔºàÂêå‰∏Ä‰ΩçÁΩÆÁöÑÈõôÊìäÊâçÈòªÊ≠¢Ôºâ
        const distance = Math.sqrt(
          Math.pow(currentPos.x - lastTouchPosition.x, 2) + 
          Math.pow(currentPos.y - lastTouchPosition.y, 2)
        );
        
        // Âè™Âú®Âêå‰∏Ä‰ΩçÁΩÆÔºàË∑ùÈõ¢Â∞èÊñº10pxÔºâ‰∏îÊôÇÈñìÈñìÈöîÂ∞èÊñº300msÊôÇÊâçÈòªÊ≠¢
        if (now - lastTouchEnd <= 300 && distance < 10) {
          event.preventDefault();
        }
        
        lastTouchPosition = currentPos;
        lastTouchEnd = now;
      }
    }, false);

    // Èò≤Ê≠¢ÊâãÊ©üÈÄ£ÈªûÊîæÂ§ß - ÈòªÊ≠¢ÊâãÂã¢Á∏ÆÊîæ
    document.addEventListener('gesturestart', function (e) {
      e.preventDefault();
    });

    document.addEventListener('gesturechange', function (e) {
      e.preventDefault();
    });

    document.addEventListener('gestureend', function (e) {
      e.preventDefault();
    });

    // Èò≤Ê≠¢ÊâãÊ©üÁâà‰∏ãÊãâÂà∑Êñ∞
    let touchStartY = 0;
    let touchStartX = 0;
    let isScrolling = false;

    document.addEventListener('touchstart', function (e) {
      touchStartY = e.touches[0].clientY;
      touchStartX = e.touches[0].clientX;
      isScrolling = false;
    }, { passive: true });

    document.addEventListener('touchmove', function (e) {
      if (!touchStartY || !touchStartX) return;
      
      const touchY = e.touches[0].clientY;
      const touchX = e.touches[0].clientX;
      const deltaY = touchY - touchStartY;
      const deltaX = touchX - touchStartX;
      
      // Âà§Êñ∑ÊòØÂê¶ÁÇ∫ÂûÇÁõ¥ÊªæÂãï
      if (Math.abs(deltaY) > Math.abs(deltaX)) {
        isScrolling = true;
        
        // Â¶ÇÊûúÈ†ÅÈù¢Â∑≤Á∂ìÂú®È†ÇÈÉ®‰∏îÂêë‰∏ãÊªëÂãïÔºåÈòªÊ≠¢‰∏ãÊãâÂà∑Êñ∞
        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
        if (scrollTop === 0 && deltaY > 0) {
          e.preventDefault();
        }
        // Â¶ÇÊûúÈ†ÅÈù¢Â∑≤Á∂ìÂú®Â∫ïÈÉ®‰∏îÂêë‰∏äÊªëÂãïÔºå‰πüÈòªÊ≠¢ÔºàÈò≤Ê≠¢Ëß∏ÁôºÂà∑Êñ∞Ôºâ
        const scrollHeight = document.documentElement.scrollHeight;
        const clientHeight = document.documentElement.clientHeight;
        if (scrollTop + clientHeight >= scrollHeight - 1 && deltaY < 0) {
          e.preventDefault();
        }
      }
    }, { passive: false });

    document.addEventListener('touchend', function (e) {
      touchStartY = 0;
      touchStartX = 0;
      isScrolling = false;
    }, { passive: true });

    // ÂàùÂßãÂåñ
    document.addEventListener('DOMContentLoaded', () => {
      // ÂõûËªäÈçµÁôªÈåÑ
      document.getElementById('usernameInput').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          loginOrRegister();
        }
      });

      // ÁÇ∫ÊâÄÊúâÊåâÈàïÊ∑ªÂä† touch-action Èò≤Ê≠¢Á∏ÆÊîæÔºå‰ΩÜ‰∏çÈòªÊ≠¢Âø´ÈÄüÈÄ£Èªû
      const buttons = document.querySelectorAll('button, .click-button');
      buttons.forEach(button => {
        button.style.touchAction = 'manipulation';
        // ‰∏çÈòªÊ≠¢ÊåâÈàïÁöÑÂø´ÈÄüÈÄ£ÈªûÔºåÂè™Ë®≠ÁΩÆ touch-action Âç≥ÂèØ
      });

      // ÈªûÊìäÊ®°ÊÖãÊ°ÜÂ§ñÈÉ®ÈóúÈñâ
      document.getElementById('shopModal').addEventListener('click', (e) => {
        if (e.target.id === 'shopModal') {
          closeShop();
        }
      });

      document.getElementById('achievementsModal').addEventListener('click', (e) => {
        if (e.target.id === 'achievementsModal') {
          closeAchievements();
        }
      });

      document.getElementById('gameHelpModal').addEventListener('click', (e) => {
        if (e.target.id === 'gameHelpModal') {
          closeGameHelp();
        }
      });

      // ÂæΩÁ´†ÈÅ∏ÊìáÊ®°ÊÖãÊ°ÜÈªûÊìäÂ§ñÈÉ®ÈóúÈñâ
      document.getElementById('badgeSelectModal').addEventListener('click', (e) => {
        if (e.target.id === 'badgeSelectModal') {
          closeBadgeSelect();
        }
      });

      document.getElementById('accountModal').addEventListener('click', (e) => {
        if (e.target.id === 'accountModal') {
          closeAccount();
        }
      });

      document.getElementById('historyModal').addEventListener('click', (e) => {
        if (e.target.id === 'historyModal') {
          closeHistory();
        }
      });

      // ÈªûÊìäÂ§ñÈÉ®ÈóúÈñâË®≠ÂÆö‰∏ãÊãâÈÅ∏ÂñÆ
      document.addEventListener('click', (e) => {
        const settingsContainer = document.querySelector('.settings-container');
        const settingsDropdown = document.getElementById('settingsDropdown');
        if (settingsContainer && settingsDropdown && 
            !settingsContainer.contains(e.target) && 
            settingsDropdown.classList.contains('active')) {
          closeSettings();
        }
      });

      // ÂòóË©¶Âä†ËºâÂ∑≤ÊúâË≥áÊñôÔºàÁ´ãÂç≥Âü∑Ë°åÔºå‰∏çÁ≠âÂæÖÔºâ
      loadProfile();
    });
  </script>
  
  <!-- Vercel Speed Insights -->
  <script defer src="https://vercel.com/speed-insights/script.js"></script>
</body>
</html>
